<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial ¬∑ Mera.jl</title><meta name="title" content="Tutorial ¬∑ Mera.jl"/><meta property="og:title" content="Tutorial ¬∑ Mera.jl"/><meta property="twitter:title" content="Tutorial ¬∑ Mera.jl"/><meta name="description" content="Documentation for Mera.jl."/><meta property="og:description" content="Documentation for Mera.jl."/><meta property="twitter:description" content="Documentation for Mera.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Mera.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../00_multi_FirstSteps/">First Steps</a></li><li><span class="tocitem">1 Data Inspection</span><ul><li><a class="tocitem" href="../01_hydro_First_Inspection/">Hydro</a></li><li><a class="tocitem" href="../01_particles_First_Inspection/">Particles</a></li><li><a class="tocitem" href="../01_clumps_First_Inspection/">Clumps</a></li><li><a class="tocitem" href="../api/data_inspection/">API Reference</a></li></ul></li><li><span class="tocitem">2 Load by Selection</span><ul><li><a class="tocitem" href="../02_hydro_Load_Selections/">Hydro</a></li><li><a class="tocitem" href="../02_particles_Load_Selections/">Particles</a></li><li><a class="tocitem" href="../02_clumps_Load_Selections/">Clumps</a></li><li><a class="tocitem" href="../api/data_loading/">API Reference</a></li></ul></li><li><span class="tocitem">3 Get Subregions</span><ul><li><a class="tocitem" href="../03_hydro_Get_Subregions/">Hydro</a></li><li><a class="tocitem" href="../03_particles_Get_Subregions/">Particles</a></li><li><a class="tocitem" href="../03_clumps_Get_Subregions/">Clumps</a></li><li><a class="tocitem" href="../api/subregions/">API Reference</a></li></ul></li><li><span class="tocitem">4 Basic Calculations</span><ul><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Learning-Objectives"><span>Learning Objectives</span></a></li><li><a class="tocitem" href="#Technical-Foundation"><span>Technical Foundation</span></a></li><li><a class="tocitem" href="#Quick-Reference"><span>Quick Reference</span></a></li><li><a class="tocitem" href="#Data-Setup-and-Initialization"><span>Data Setup and Initialization</span></a></li><li><a class="tocitem" href="#Total-Mass-Calculations"><span>Total Mass Calculations</span></a></li><li><a class="tocitem" href="#Center-Of-Mass"><span>Center-Of-Mass</span></a></li><li><a class="tocitem" href="#Bulk-Velocity"><span>Bulk Velocity</span></a></li><li><a class="tocitem" href="#Mass-Weighted-Average"><span>Mass Weighted Average</span></a></li><li><a class="tocitem" href="#Get-Predefined-Quantities"><span>Get Predefined Quantities</span></a></li><li><a class="tocitem" href="#Create-Costum-Quantities"><span>Create Costum Quantities</span></a></li><li><a class="tocitem" href="#Statistical-Analysis"><span>Statistical Analysis</span></a></li><li><a class="tocitem" href="#Weighted-Statistics"><span>Weighted Statistics</span></a></li><li><a class="tocitem" href="#Helpful-Functions"><span>Helpful Functions</span></a></li><li><a class="tocitem" href="#Summary"><span>Summary</span></a></li></ul></li><li><a class="tocitem" href="../api/calculations/">API Reference</a></li></ul></li><li><span class="tocitem">5 Mask/Filter/Meta</span><ul><li><a class="tocitem" href="../05_multi_Masking_Filtering/">Tutorial</a></li><li><a class="tocitem" href="../api/masking_filtering/">API Reference</a></li></ul></li><li><span class="tocitem">6 Projection</span><ul><li><a class="tocitem" href="../06_hydro_Projection/">Hydro</a></li><li><a class="tocitem" href="../06_particles_Projection/">Particles</a></li><li><a class="tocitem" href="../api/projections/">API Reference</a></li></ul></li><li><span class="tocitem">7 MERA-Files</span><ul><li><a class="tocitem" href="../07_multi_Mera_Files/">Mera-Files</a></li><li><a class="tocitem" href="../07_1_multi_Mera_Files_Converter/">Converter</a></li><li><a class="tocitem" href="../api/mera_files/">API Reference</a></li></ul></li><li><span class="tocitem">8 Volume Rendering</span><ul><li><a class="tocitem" href="../paraview/paraview_intro/">Intro</a></li><li><a class="tocitem" href="../paraview/08_hydro_VTK_export/">Hydro</a></li><li><a class="tocitem" href="../paraview/08_particles_VTK_export/">Particles</a></li><li><a class="tocitem" href="../api/volume_rendering/">API Reference</a></li></ul></li><li><span class="tocitem">9 Miscellaneous</span><ul><li><a class="tocitem" href="../Miscellaneous/">Tutorial</a></li><li><a class="tocitem" href="../api/miscellaneous/">API Reference</a></li></ul></li><li><span class="tocitem">10 Examples</span><ul><li><a class="tocitem" href="../examples/">Tutorial</a></li><li><a class="tocitem" href="../api/examples/">API Reference</a></li></ul></li><li><span class="tocitem">11 Multi-Threading</span><ul><li><a class="tocitem" href="../multi-threading/multi-threading_intro/">Tutorial</a></li><li><a class="tocitem" href="../api/multithreading/">API Reference</a></li></ul></li><li><span class="tocitem">12 Notifications</span><ul><li><a class="tocitem" href="../notifications/">Overview</a></li><li><a class="tocitem" href="../notifications/bell/">Bell (Local Audio)</a></li><li><a class="tocitem" href="../notifications/email/">Email</a></li><li><a class="tocitem" href="../notifications/zulip/">Zulip (Team Chat)</a></li><li><a class="tocitem" href="../api/notifications/">API Reference</a></li></ul></li><li><span class="tocitem">13 Benchmarks</span><ul><li><a class="tocitem" href="../benchmarks/IO/IOperformance/">Server IO</a></li><li><a class="tocitem" href="../benchmarks/RAMSES_reading/ramses_reading/">Parallel RAMSES-Files Reading</a></li><li><a class="tocitem" href="../benchmarks/JLD2_reading/Mera_files_reading/">Mera-Files Reading</a></li><li><a class="tocitem" href="../benchmarks/Projection/multi_projections/">Parallel Projections</a></li></ul></li><li><span class="tocitem">14 Julia Quick Reference</span><ul><li><a class="tocitem" href="../quickreference/01_getting_started/">Getting Started</a></li><li><a class="tocitem" href="../quickreference/02_migrators/">From Other Languages</a></li><li><a class="tocitem" href="../quickreference/03_packages/">Essential Packages</a></li><li><a class="tocitem" href="../quickreference/04_mera_patterns/">Julia Fundamentals</a></li><li><a class="tocitem" href="../quickreference/05_performance/">Performance &amp; Debugging</a></li><li><a class="tocitem" href="../quickreference/06_resources/">Resources &amp; Community</a></li></ul></li><li><a class="tocitem" href="../api/">15 Complete API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">4 Basic Calculations</a></li><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="4.-Multi-Physics-Basic-Calculations-and-Statistical-Analysis"><a class="docs-heading-anchor" href="#4.-Multi-Physics-Basic-Calculations-and-Statistical-Analysis">4. Multi-Physics Basic Calculations and Statistical Analysis</a><a id="4.-Multi-Physics-Basic-Calculations-and-Statistical-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#4.-Multi-Physics-Basic-Calculations-and-Statistical-Analysis" title="Permalink"></a></h1><p>This comprehensive tutorial demonstrates essential computational methods for analyzing multi-physics simulation data using MERA.jl. Learn to calculate fundamental quantities, statistical measures, and derived properties across hydro, particle, and clump datasets with proper unit handling and weighting schemes.</p><h2 id="Learning-Objectives"><a class="docs-heading-anchor" href="#Learning-Objectives">Learning Objectives</a><a id="Learning-Objectives-1"></a><a class="docs-heading-anchor-permalink" href="#Learning-Objectives" title="Permalink"></a></h2><p>By the end of this tutorial, you will be able to:</p><ul><li><strong>Calculate fundamental quantities</strong> - Total mass, center-of-mass, and bulk velocities across all data types</li><li><strong>Apply proper unit conversions</strong> - Seamlessly work with physical units and automatic scaling</li><li><strong>Perform statistical analysis</strong> - Compute weighted and unweighted statistical measures</li><li><strong>Extract derived quantities</strong> - Use <code>getvar()</code> for predefined and custom variable calculations</li><li><strong>Implement weighting schemes</strong> - Apply mass, volume, and density weighting for accurate averages</li><li><strong>Combine multi-physics data</strong> - Joint calculations across hydro, particle, and clump datasets</li><li><strong>Optimize computational workflows</strong> - Efficient data processing and memory management</li></ul><h2 id="Technical-Foundation"><a class="docs-heading-anchor" href="#Technical-Foundation">Technical Foundation</a><a id="Technical-Foundation-1"></a><a class="docs-heading-anchor-permalink" href="#Technical-Foundation" title="Permalink"></a></h2><h3 id="MERA-Data-Type-Hierarchy"><a class="docs-heading-anchor" href="#MERA-Data-Type-Hierarchy">MERA Data Type Hierarchy</a><a id="MERA-Data-Type-Hierarchy-1"></a><a class="docs-heading-anchor-permalink" href="#MERA-Data-Type-Hierarchy" title="Permalink"></a></h3><p>MERA organizes simulation data through a sophisticated type system that enables unified computational methods across different physics components:</p><p><strong>Core Data Types:</strong></p><ul><li><code>ContainMassDataSetType</code> - Abstract supertype for mass-containing datasets</li><li><code>HydroDataType</code> - Hydrodynamic data with fluid properties (density, velocity, pressure)</li><li><code>PartDataType</code> - Particle data with discrete mass elements and positions</li><li><code>ClumpDataType</code> - Clump catalog data</li><li><code>HydroPartType</code> - Combined hydro-particle data for mixed-physics analysis</li></ul><p><img src="../assets/TypeHierarchy.png" alt="TypeHierarchy"/> <strong>Unified Interface Benefits:</strong></p><ul><li><strong>Consistent function signatures</strong> - Same functions work across all data types</li><li><strong>Automatic unit handling</strong> - Built-in scaling between code and physical units</li><li><strong>Type-aware calculations</strong> - Optimized algorithms for each data structure</li><li><strong>Extensible framework</strong> - Easy addition of new calculation methods</li></ul><h3 id="Fundamental-Calculation-Functions"><a class="docs-heading-anchor" href="#Fundamental-Calculation-Functions">Fundamental Calculation Functions</a><a id="Fundamental-Calculation-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Fundamental-Calculation-Functions" title="Permalink"></a></h3><p><strong>Mass and Position Functions:</strong></p><ul><li><code>msum(data, unit)</code> - Total mass calculation with automatic unit conversion</li><li><code>center_of_mass(data, unit)</code> / <code>com(data, unit)</code> - Mass-weighted center calculation</li><li><code>bulk_velocity(data, unit)</code> - Mass-weighted average velocity calculation</li><li><code>average_mweighted(data, var, unit)</code> - General mass-weighted averaging</li></ul><p><strong>Statistical Analysis Functions:</strong></p><ul><li><code>wstat(values, weights)</code> - Comprehensive weighted statistical analysis</li><li><code>getvar(data, vars, units)</code> - Variable extraction with unit conversion</li><li><code>getpositions(data, unit, center)</code> - Position extraction with coordinate transformation</li><li><code>getextent(data, unit, center)</code> - Domain boundary calculation</li></ul><h3 id="Unit-System-Architecture"><a class="docs-heading-anchor" href="#Unit-System-Architecture">Unit System Architecture</a><a id="Unit-System-Architecture-1"></a><a class="docs-heading-anchor-permalink" href="#Unit-System-Architecture" title="Permalink"></a></h3><p><strong>Code Units (Default):</strong></p><ul><li>Internal simulation units optimized for numerical precision</li><li>Dimensionless or normalized to characteristic scales</li><li>Direct output from computational algorithms</li></ul><p><strong>Physical Units (Converted):</strong></p><ul><li>Standard astronomical units (Msol, kpc, Myr, km/s, etc.)</li><li>Automatic scaling using <code>info.scale</code> conversion factors</li><li>User-specified through function parameters</li></ul><p><strong>Conversion Hierarchy:</strong></p><pre><code class="language-julia hljs"># Manual scaling (explicit)
result_physical = result_code * info.scale.unit

# Automatic scaling (recommended)
result_physical = function(data, :unit)</code></pre><h3 id="Weighting-Schemes"><a class="docs-heading-anchor" href="#Weighting-Schemes">Weighting Schemes</a><a id="Weighting-Schemes-1"></a><a class="docs-heading-anchor-permalink" href="#Weighting-Schemes" title="Permalink"></a></h3><p><strong>Mass Weighting (Default):</strong></p><ul><li>Appropriate for most physical quantities</li><li>Emphasizes high-mass regions</li><li>Standard for velocity, position averaging</li></ul><p><strong>Volume Weighting:</strong></p><ul><li>Used for density-related quantities</li><li>Accounts for spatial resolution effects</li><li>Important for grid-based hydrodynamic data</li></ul><p><strong>No Weighting:</strong></p><ul><li>Simple arithmetic averaging</li><li>Useful for discrete particle properties</li><li>Equal treatment of all data elements</li></ul><h2 id="Quick-Reference"><a class="docs-heading-anchor" href="#Quick-Reference">Quick Reference</a><a id="Quick-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Reference" title="Permalink"></a></h2><pre><code class="language-julia hljs"># Basic mass calculations
msum(gas, :Msol)                    # Total gas mass
msum([gas, particles], :Msol)       # Combined mass

# Center-of-mass calculations
com(gas, :kpc)                      # Gas center-of-mass
com([gas, particles], :kpc)         # Joint center-of-mass

# Velocity analysis
bulk_velocity(gas, :km_s)           # Mass-weighted velocity
bulk_velocity(gas, :km_s, weighting=:volume)  # Volume-weighted

# Statistical analysis
wstat(getvar(gas, :rho, :g_cm3))    # Unweighted statistics
wstat(getvar(gas, :vx, :km_s), weight=getvar(gas, :mass))  # Weighted

# Variable extraction
getvar(gas, :mass, :Msol)           # Single variable
getvar(gas, [:mass, :ekin], [:Msol, :erg])  # Multiple variables

# Coordinate related
getpositions(gas, :kpc, center=[:boxcenter])  # Position arrays
getextent(gas, :kpc, center=[:boxcenter])     # Domain boundaries

# Time and scaling information
gettime(info, :Myr)                 # Simulation time
viewfields(info.scale)              # Available unit conversions</code></pre><h2 id="Data-Setup-and-Initialization"><a class="docs-heading-anchor" href="#Data-Setup-and-Initialization">Data Setup and Initialization</a><a id="Data-Setup-and-Initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Setup-and-Initialization" title="Permalink"></a></h2><p>Load multi-physics simulation data for comprehensive analysis demonstrations:</p><pre><code class="language-julia hljs">using Mera
info = getinfo(400, &quot;/Volumes/FASTStorage/Simulations/Mera-Tests/manu_sim_sf_L14&quot;);
gas       = gethydro(info, [:rho, :vx, :vy, :vz], lmax=8);
particles = getparticles(info, [:mass, :vx, :vy, :vz])
clumps    = getclumps(info);</code></pre><pre><code class="nohighlight hljs">[Mera]: 2025-08-14T14:44:55.027

Code: RAMSES
output [400] summary:
mtime: 2018-09-05T09:51:55
ctime: 2025-06-29T20:06:45.267
=======================================================
simulation time: 594.98 [Myr]
boxlen: 48.0 [kpc]
ncpu: 2048
ndim: 3
-------------------------------------------------------
amr:           true
level(s): 6 - 14 --&gt; cellsize(s): 750.0 [pc] - 2.93 [pc]
-------------------------------------------------------
hydro:         true
hydro-variables:  7  --&gt; (:rho, :vx, :vy, :vz, :p, :var6, :var7)
hydro-descriptor: (:density, :velocity_x, :velocity_y, :velocity_z, :thermal_pressure, :passive_scalar_1, :passive_scalar_2)
Œ≥: 1.6667
-------------------------------------------------------
gravity:       true
gravity-variables: (:epot, :ax, :ay, :az)
-------------------------------------------------------
particles:     true
- Npart:    5.091500e+05
- Nstars:   5.066030e+05
- Ndm:      2.547000e+03
particle-variables: 5  --&gt; (:vx, :vy, :vz, :mass, :birth)
-------------------------------------------------------
rt:            false
-------------------------------------------------------
clumps:           true
clump-variables: (:index, :lev, :parent, :ncell, :peak_x, :peak_y, :peak_z, Symbol(&quot;rho-&quot;), Symbol(&quot;rho+&quot;), :rho_av, :mass_cl, :relevance)
-------------------------------------------------------
namelist-file:    false
timer-file:       false
compilation-file: true
makefile:         true
patchfile:        true
=======================================================

[Mera]: Get hydro data: 2025-08-14T14:44:59.267

Key vars=(:level, :cx, :cy, :cz)
Using var(s)=(1, 2, 3, 4) = (:rho, :vx, :vy, :vz)

domain:
xmin::xmax: 0.0 :: 1.0  	==&gt; 0.0 [kpc] :: 48.0 [kpc]
ymin::ymax: 0.0 :: 1.0  	==&gt; 0.0 [kpc] :: 48.0 [kpc]
zmin::zmax: 0.0 :: 1.0  	==&gt; 0.0 [kpc] :: 48.0 [kpc]

üìä Processing Configuration:
   Total CPU files available: 2048
   Files to be processed: 2048
   Compute threads: 8
   GC threads: 4
</code></pre><pre><code class="nohighlight hljs">Processing files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:47 (23.39 ms/it)Processing files:   0%|‚ñè                                                 |  ETA: 0:02:37 (76.89 ms/it)
</code></pre><pre><code class="nohighlight hljs">
‚úì File processing complete! Combining results...
‚úì Data combination complete!
Final data size: 849332 cells, 4 variables
Creating Table from 849332 cells with max 8 threads...
  Threading: 8 threads for 8 columns
  Max threads requested: 8
  Available threads: 8
  Using parallel processing with 8 threads
  Creating IndexedTable with 8 columns...
  0.754143 seconds (3.99 M allocations: 355.524 MiB, 1.18% gc time, 114.82% compilation time)
‚úì Table created in 0.939 seconds
Memory used for data table :51.839996337890625 MB
-------------------------------------------------------

[Mera]: Get particle data: 2025-08-14T14:45:51.680

Using threaded processing with 8 threads
Key vars=(:level, :x, :y, :z, :id)
Using var(s)=(1, 2, 3, 4) = (:vx, :vy, :vz, :mass)

domain:
xmin::xmax: 0.0 :: 1.0  	==&gt; 0.0 [kpc] :: 48.0 [kpc]
ymin::ymax: 0.0 :: 1.0  	==&gt; 0.0 [kpc] :: 48.0 [kpc]
zmin::zmax: 0.0 :: 1.0  	==&gt; 0.0 [kpc] :: 48.0 [kpc]

Processing 2048 CPU files using 8 threads
Mode: Threaded processing
Combining results from 8 thread(s)...
Found 5.089390e+05 particles
Memory used for data table :31.064148902893066 MB
-------------------------------------------------------

[Mera]: Get clump data: 2025-08-14T14:46:01.837

domain:
xmin::xmax: 0.0 :: 1.0  	==&gt; 0.0 [kpc] :: 48.0 [kpc]
ymin::ymax: 0.0 :: 1.0  	==&gt; 0.0 [kpc] :: 48.0 [kpc]
zmin::zmax: 0.0 :: 1.0  	==&gt; 0.0 [kpc] :: 48.0 [kpc]

Read 12 colums:
[:index, :lev, :parent, :ncell, :peak_x, :peak_y, :peak_z, Symbol(&quot;rho-&quot;), Symbol(&quot;rho+&quot;), :rho_av, :mass_cl, :relevance]
Memory used for data table :61.58203125 KB
-------------------------------------------------------
</code></pre><h3 id="Unit-Conversion-System"><a class="docs-heading-anchor" href="#Unit-Conversion-System">Unit Conversion System</a><a id="Unit-Conversion-System-1"></a><a class="docs-heading-anchor-permalink" href="#Unit-Conversion-System" title="Permalink"></a></h3><p>MERA provides comprehensive unit conversion capabilities through the <code>info.scale</code> object, which contains conversion factors between code units and physical units. Understanding this system is crucial for accurate scientific analysis.</p><p><strong>Core Conversion Principles:</strong></p><ul><li><strong>Code units</strong> - Internal simulation units optimized for numerical stability</li><li><strong>Physical units</strong> - Standard astronomical units for scientific interpretation</li><li><strong>Automatic scaling</strong> - Functions handle conversions internally when units are specified</li><li><strong>Consistent framework</strong> - Same unit system across all data types and functions</li></ul><p>Many functions can provide results in selected units through automatic internal scaling:</p><pre><code class="language-julia hljs">viewfields(info.scale)</code></pre><pre><code class="nohighlight hljs">
[Mera]: Fields to scale from user/code units to selected units
=======================================================================
Mpc	= 0.0010000000000006482
kpc	= 1.0000000000006481
pc	= 1000.0000000006482
mpc	= 1.0000000000006482e6
ly	= 3261.5637769461323
Au	= 2.0626480623310105e23
km	= 3.0856775812820004e16
m	= 3.085677581282e19
cm	= 3.085677581282e21
mm	= 3.085677581282e22
Œºm	= 3.085677581282e25
Mpc3	= 1.0000000000019446e-9
kpc3	= 1.0000000000019444
pc3	= 1.0000000000019448e9
mpc3	= 1.0000000000019446e18
ly3	= 3.469585750743794e10
Au3	= 8.775571306099254e69
km3	= 2.9379989454983075e49
m3	= 2.9379989454983063e58
cm3	= 2.9379989454983065e64
mm3	= 2.937998945498306e67
Œºm3	= 2.937998945498306e76
Msol_pc3	= 0.9997234790001649
Msun_pc3	= 0.9997234790001649
g_cm3	= 6.76838218451376e-23
Msol_pc2	= 999.7234790008131
Msun_pc2	= 999.7234790008131
g_cm2	= 0.20885045168302602
Gyr	= 0.014910986463557083
Myr	= 14.910986463557084
yr	= 1.4910986463557083e7
s	= 4.70554946422349e14
ms	= 4.70554946422349e17
Msol	= 9.99723479002109e8
Msun	= 9.99723479002109e8
Mearth	= 3.329677459032007e14
Mjupiter	= 1.0476363431814971e12
g	= 1.9885499720830952e42
km_s	= 65.57528732282063
m_s	= 65575.28732282063
cm_s	= 6.557528732282063e6
nH	= 30.987773856809987
erg	= 8.551000140274429e55
g_cms2	= 2.9104844143584656e-9
T_mu	= 517017.45993377
K_mu	= 517017.45993377
T	= 680286.1314918026
K	= 680286.1314918026
Ba	= 2.910484414358466e-9
g_cm_s2	= 2.910484414358466e-9
p_kB	= 2.1080552800592083e7
K_cm3	= 2.1080552800592083e7
erg_g_K	= 3.114563011649217e29
keV_cm2	= 1.252773885965637e65
erg_K	= 6.193464189866091e71
J_K	= 6.193464189866091e64
erg_cm3_K	= 2.1080552800592083e7
J_m3_K	= 2.1080552800592083e8
kB_per_particle	= 1.380649e-16
J_s	= 4.023715412864333e70
g_cm2_s	= 4.023715412864333e70
kg_m2_s	= 4.023715412864333e71
Gauss	= 0.00019124389093025845
muG	= 191.24389093025846
microG	= 191.24389093025846
Tesla	= 1.9124389093025845e-8
eV	= 5.3371144971238105e67
keV	= 5.33711449712381e64
MeV	= 5.33711449712381e61
erg_s	= 1.8172160775884043e41
Lsol	= 4.747168436751317e7
Lsun	= 4.747168436751317e7
cm_3	= 3.4036771916893676e-65
pc_3	= 1.158501842524895e-120
n_e	= 30.987773856809987
erg_g_s	= 0.09138397843151959
erg_cm3_s	= 6.185216915658869e-24
erg_cm2_s	= 6.185216915658869e-24
Jy	= 0.6185216915658869
mJy	= 618.5216915658868
microJy	= 618521.6915658868
atoms_cm2	= 1.2581352511025663e23
NH_cm2	= 1.2581352511025663e23
cm_s2	= 1.3935734353956443e-8
m_s2	= 1.3935734353956443e-10
km_s2	= 1.3935734353956443e-13
pc_Myr2	= 3.09843657823729e-9
erg_g	= 4.30011830747048e13
J_kg	= 4.30011830747048e6
km2_s2	= 4300.1183074704795
u_grav	= 2.910484414358466e-9
erg_cell	= 8.55100014027443e55
dyne	= 9.432237612943517e-31
s_2	= 4.516263928056473e-30
lambda_J	= 3.085677581282e21
M_J	= 1.9885499720830952e42
t_ff	= 4.70554946422349e14
alpha_vir	= 1.0
delta_rho	= 3.5e-322
a_mag	= 3.75e-322
v_esc	= 2.2330385943e-314
ax	= 2.23303861e-314
ay	= 3.8e-322
az	= 3.9e-322
epot	= 2.233038626e-314
a_magnitude	= 2.2330386417e-314
escape_speed	= 3.95e-322
gravitational_redshift	= 4.0e-322
gravitational_energy_density	= 2.2330386575e-314
gravitational_binding_energy	= 2.233038705e-314
total_binding_energy	= 4.05e-322
specific_gravitational_energy	= 4.30011830747048e13
gravitational_work	= 2.2330387524e-314
jeans_length_gravity	= 3.085677581282e21
jeans_mass_gravity	= 1.9885499720830952e42
jeansmass	= 1.9885499720830952e42
freefall_time_gravity	= 4.70554946422349e14
ekin	= 8.551000140274429e55
etherm	= 8.551000140274429e55
virial_parameter_local	= 1.0
Fg	= 2.233038863e-314
poisson_source	= 2.233038879e-314
ar_cylinder	= 1.3935734353956443e-8
aœï_cylinder	= 1.3935734353956443e-8
ar_sphere	= 1.3935734353956443e-8
aŒ∏_sphere	= 1.3935734353956443e-8
aœï_sphere	= 1.3935734353956443e-8
r_cylinder	= 3.085677581282e21
r_sphere	= 3.085677581282e21
œï	= 1.0
dimensionless	= 1.0
rad	= 1.0
deg	= 57.29577951308232
</code></pre><h2 id="Total-Mass-Calculations"><a class="docs-heading-anchor" href="#Total-Mass-Calculations">Total Mass Calculations</a><a id="Total-Mass-Calculations-1"></a><a class="docs-heading-anchor-permalink" href="#Total-Mass-Calculations" title="Permalink"></a></h2><p>Mass calculations form the foundation of astrophysical analysis, providing essential information about the distribution of matter across different simulation components. MERA&#39;s <code>msum()</code> function offers sophisticated mass calculation capabilities with automatic unit conversion and support for multi-physics datasets.</p><h3 id="Key-Features:"><a class="docs-heading-anchor" href="#Key-Features:">Key Features:</a><a id="Key-Features:-1"></a><a class="docs-heading-anchor-permalink" href="#Key-Features:" title="Permalink"></a></h3><ul><li><strong>Universal data type support</strong> - Works with hydro, particle, and clump data</li><li><strong>Automatic unit conversion</strong> - Built-in scaling to physical units</li><li><strong>Multi-dataset combinations</strong> - Joint mass calculations across data types</li><li><strong>Precision handling</strong> - Optimized algorithms for numerical accuracy</li></ul><h3 id="Physical-Basis:"><a class="docs-heading-anchor" href="#Physical-Basis:">Physical Basis:</a><a id="Physical-Basis:-1"></a><a class="docs-heading-anchor-permalink" href="#Physical-Basis:" title="Permalink"></a></h3><ul><li><strong>Hydrodynamic mass</strong> - Derived from density and cell volume (œÅ √ó V)</li><li><strong>Particle mass</strong> - Direct summation of discrete particle masses</li><li><strong>Clump mass</strong> - Hierarchical structure mass accounting</li></ul><h3 id="Basic-Mass-Calculation"><a class="docs-heading-anchor" href="#Basic-Mass-Calculation">Basic Mass Calculation</a><a id="Basic-Mass-Calculation-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Mass-Calculation" title="Permalink"></a></h3><p>The <code>msum()</code> function calculates the total mass of data assigned to any MERA object. For hydrodynamic data, mass is derived from density and cell-size (level) of all elements, while particle data uses direct mass summation.</p><p><strong>Manual Unit Conversion:</strong> The traditional approach requires manual scaling using <code>info.scale.Msol</code> (or equivalent):</p><pre><code class="language-julia hljs">println( &quot;Gas Mtot:       &quot;, msum(gas)       * info.scale.Msol, &quot; Msol&quot; )
println( &quot;Particles Mtot: &quot;, msum(particles) * info.scale.Msol, &quot; Msol&quot; )
println( &quot;Clumps Mtot:    &quot;, msum(clumps)    * info.scale.Msol, &quot; Msol&quot; )</code></pre><pre><code class="nohighlight hljs">Gas Mtot:       2.6703951073850353e10 Msol
Particles Mtot: 5.804426008528429e9 Msol
Clumps Mtot:    1.3743280681841675e10 Msol
</code></pre><h3 id="Automatic-Unit-Conversion"><a class="docs-heading-anchor" href="#Automatic-Unit-Conversion">Automatic Unit Conversion</a><a id="Automatic-Unit-Conversion-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-Unit-Conversion" title="Permalink"></a></h3><p><strong>Recommended Approach:</strong> The modern approach uses built-in unit conversion by providing a unit argument directly to the function:</p><pre><code class="language-julia hljs">println( &quot;Gas Mtot:       &quot;, msum(gas, :Msol)       , &quot; Msol&quot; )
println( &quot;Particles Mtot: &quot;, msum(particles, :Msol) , &quot; Msol&quot; )
println( &quot;Clumps Mtot:    &quot;, msum(clumps, :Msol)    , &quot; Msol&quot; )</code></pre><pre><code class="nohighlight hljs">Gas Mtot:       2.6703951073850353e10 Msol
Particles Mtot: 5.804426008528429e9 Msol
Clumps Mtot:    1.3743280681841675e10 Msol
</code></pre><p>The following methods are defined on the function <code>msum</code>:</p><pre><code class="language-julia hljs">methods(msum)</code></pre><p><strong>Available methods for <code>msum</code>:</strong></p><pre><code class="language-julia hljs">[1] msum(dataobject::ContainMassDataSetType; unit, mask)
[2] msum(dataobject::ContainMassDataSetType, unit::Symbol; mask)</code></pre><h2 id="Center-Of-Mass"><a class="docs-heading-anchor" href="#Center-Of-Mass">Center-Of-Mass</a><a id="Center-Of-Mass-1"></a><a class="docs-heading-anchor-permalink" href="#Center-Of-Mass" title="Permalink"></a></h2><p>The function <code>center_of_mass</code> or <code>com</code> calculates the center-of-mass of the data that is assigned to the provided object.</p><pre><code class="language-julia hljs">println( &quot;Gas COM:       &quot;, center_of_mass(gas)       .* info.scale.kpc, &quot; kpc&quot; )
println( &quot;Particles COM: &quot;, center_of_mass(particles) .* info.scale.kpc, &quot; kpc&quot; )
println( &quot;Clumps COM:    &quot;, center_of_mass(clumps)    .* info.scale.kpc, &quot; kpc&quot; );</code></pre><pre><code class="nohighlight hljs">Gas COM:       (23.32748735447764, 23.835419919525915, 24.04172014803584) kpc
Particles COM: (22.891354761211396, 24.17414728268034, 24.003205056545642) kpc
Clumps COM:    (23.135765457064572, 23.741712325649264, 24.0050127185862) kpc
</code></pre><p>The units for the results can be calculated by the function itself by providing a unit-argument:</p><pre><code class="language-julia hljs">println( &quot;Gas COM:       &quot;, center_of_mass(gas, :kpc)       , &quot; kpc&quot; )
println( &quot;Particles COM: &quot;, center_of_mass(particles, :kpc) , &quot; kpc&quot; )
println( &quot;Clumps COM:    &quot;, center_of_mass(clumps, :kpc)    , &quot; kpc&quot; );</code></pre><pre><code class="nohighlight hljs">Gas COM:       (23.32748735447764, 23.835419919525915, 24.04172014803584) kpc
Particles COM: (22.891354761211396, 24.17414728268034, 24.003205056545642) kpc
Clumps COM:    (23.135765457064572, 23.741712325649264, 24.0050127185862) kpc
</code></pre><p>A shorter name for the function <code>center_of_mass</code> is defined as <code>com</code> :</p><pre><code class="language-julia hljs">println( &quot;Gas COM:       &quot;, com(gas, :kpc)       , &quot; kpc&quot; )
println( &quot;Particles COM: &quot;, com(particles, :kpc) , &quot; kpc&quot; )
println( &quot;Clumps COM:    &quot;, com(clumps, :kpc)    , &quot; kpc&quot; );</code></pre><pre><code class="nohighlight hljs">Gas COM:       (23.32748735447764, 23.835419919525915, 24.04172014803584) kpc
Particles COM: (22.891354761211396, 24.17414728268034, 24.003205056545642) kpc
Clumps COM:    (23.135765457064572, 23.741712325649264, 24.0050127185862) kpc
</code></pre><p>The result of the coordinates (x, y, z) can be assigned e.g. to a tuple or to three single variables:</p><pre><code class="language-julia hljs"># return coordinates in a tuple
com_gas = com(gas, :kpc)
println( &quot;Tuple:      &quot;, com_gas, &quot; kpc&quot; )

# return coordinates into variables
x_pos, y_pos, z_pos = com(gas, :kpc);  #create variables
println(&quot;Single vars: &quot;, x_pos, &quot;  &quot;, y_pos, &quot;  &quot;, z_pos, &quot;  kpc&quot;)</code></pre><pre><code class="nohighlight hljs">Tuple:      (23.32748735447764, 23.835419919525915, 24.04172014803584) kpc
Single vars: 23.32748735447764  23.835419919525915  24.04172014803584  kpc
</code></pre><p>Calculate the joint centre-of-mass from the hydro and particle data.¬†Provide the hydro and particle data with an array (independent order):</p><pre><code class="language-julia hljs">println( &quot;Joint COM (Gas + Particles): &quot;, center_of_mass([gas,particles], :kpc) , &quot; kpc&quot; )
println( &quot;Joint COM (Particles + Gas): &quot;, center_of_mass([particles,gas], :kpc) , &quot; kpc&quot; )</code></pre><pre><code class="nohighlight hljs">Joint COM (Gas + Particles): (23.249615138763833, 23.895900266693467, 24.034843213428744) kpc
Joint COM (Particles + Gas): (23.249615138306556, 23.895900266223183, 24.03484321295532) kpc
</code></pre><p>Use the shorter name <code>com</code> that is defined as the function <code>center_of_mass</code> :</p><pre><code class="language-julia hljs">println( &quot;Joint COM (Gas + Particles): &quot;, com([gas,particles], :kpc) , &quot; kpc&quot; )
println( &quot;Joint COM (Particles + Gas): &quot;, com([particles,gas], :kpc) , &quot; kpc&quot; )</code></pre><pre><code class="nohighlight hljs">Joint COM (Gas + Particles): (23.249615138763833, 23.895900266693467, 24.034843213428744) kpc
Joint COM (Particles + Gas): (23.249615138306556, 23.895900266223183, 24.03484321295532) kpc
</code></pre><pre><code class="language-julia hljs">methods(center_of_mass)</code></pre><p><strong>Available methods for <code>center_of_mass</code>:</strong></p><pre><code class="language-julia hljs">[1] center_of_mass(dataobject::Vector{HydroPartType}; unit, mask)
[2] center_of_mass(dataobject::Vector{HydroPartType}, unit::Symbol; mask)
[3] center_of_mass(dataobject::ContainMassDataSetType; unit, mask)
[4] center_of_mass(dataobject::ContainMassDataSetType, unit::Symbol; mask)</code></pre><pre><code class="language-julia hljs">methods(com)</code></pre><p><strong>Available methods for <code>com</code>:</strong></p><pre><code class="language-julia hljs">[1] com(dataobject::Vector{HydroPartType}; unit, mask)
[2] com(dataobject::Vector{HydroPartType}, unit::Symbol; mask)
[3] com(dataobject::ContainMassDataSetType; unit, mask)
[4] com(dataobject::ContainMassDataSetType, unit::Symbol; mask)</code></pre><h2 id="Bulk-Velocity"><a class="docs-heading-anchor" href="#Bulk-Velocity">Bulk Velocity</a><a id="Bulk-Velocity-1"></a><a class="docs-heading-anchor-permalink" href="#Bulk-Velocity" title="Permalink"></a></h2><p>The function <code>bulk_velocity</code> or <code>average_velocity</code> calculates the average velocity (with and without mass-weight) of the data that is assigned to the provided object. It can also be used for the clump data if it has velocity components: vx, vy, vz. The default is with mass-weighting:</p><pre><code class="language-julia hljs">println( &quot;Gas:       &quot;, bulk_velocity(gas, :km_s)       , &quot; km/s&quot; )
println( &quot;Particles: &quot;, bulk_velocity(particles, :km_s) , &quot; km/s&quot; )</code></pre><pre><code class="nohighlight hljs">Gas:       (-1.441830310542467, -11.708719305767854, -0.5393243496862989) km/s
Particles: (-11.623422700314567, -18.440572802490294, -0.32919277314175355) km/s
</code></pre><pre><code class="language-julia hljs">println( &quot;Gas:       &quot;, average_velocity(gas, :km_s)       , &quot; km/s&quot; )
println( &quot;Particles: &quot;, average_velocity(particles, :km_s) , &quot; km/s&quot; )</code></pre><pre><code class="nohighlight hljs">Gas:       (-1.441830310542467, -11.708719305767854, -0.5393243496862989) km/s
Particles: (-11.623422700314567, -18.440572802490294, -0.32919277314175355) km/s
</code></pre><p>Without mass-weighting:</p><ul><li>gas: volume or :no weighting</li><li>particles: no weighting</li></ul><pre><code class="language-julia hljs">println( &quot;Gas:       &quot;, bulk_velocity(gas, :km_s, weighting=:volume)       , &quot; km/s&quot; )
println( &quot;Particles: &quot;, bulk_velocity(particles, :km_s, weighting=:no) , &quot; km/s&quot; )</code></pre><pre><code class="nohighlight hljs">Gas:       (1.5248458901822848, -8.770913864354457, -0.5037635305158429) km/s
Particles: (-11.594477384589647, -18.38859118719373, -0.3097746295267971) km/s
</code></pre><pre><code class="language-julia hljs">println( &quot;Gas:       &quot;, average_velocity(gas, :km_s, weighting=:volume)       , &quot; km/s&quot; )
println( &quot;Particles: &quot;, average_velocity(particles, :km_s, weighting=:no) , &quot; km/s&quot; )</code></pre><pre><code class="nohighlight hljs">Gas:       (1.5248458901822848, -8.770913864354457, -0.5037635305158429) km/s
Particles: (-11.594477384589647, -18.38859118719373, -0.3097746295267971) km/s
</code></pre><pre><code class="language-julia hljs">methods(bulk_velocity)</code></pre><p><strong>Available methods for <code>bulk_velocity</code>:</strong></p><pre><code class="language-julia hljs">[1] bulk_velocity(dataobject::ContainMassDataSetType; unit, weighting, mask)
[2] bulk_velocity(dataobject::ContainMassDataSetType, unit::Symbol; weighting, mask)</code></pre><pre><code class="language-julia hljs">methods(average_velocity)</code></pre><p><strong>Available methods for <code>average_velocity</code>:</strong></p><pre><code class="language-julia hljs">[1] average_velocity(dataobject::ContainMassDataSetType; unit, weighting, mask)
[2] average_velocity(dataobject::ContainMassDataSetType, unit::Symbol; weighting, mask)</code></pre><h2 id="Mass-Weighted-Average"><a class="docs-heading-anchor" href="#Mass-Weighted-Average">Mass Weighted Average</a><a id="Mass-Weighted-Average-1"></a><a class="docs-heading-anchor-permalink" href="#Mass-Weighted-Average" title="Permalink"></a></h2><p>The functions <code>center_of_mass</code> and <code>bulk_velocity</code> use the function <code>average_mweighted</code> (average_mass-weighted) in the backend which can be feeded with any kind of variable that is pre-defined for the <code>getvar()</code> function or exists in the datatable. See the defined method and at getvar() below:</p><pre><code class="language-julia hljs">methods( average_mweighted )</code></pre><p><strong>Available methods for <code>average_mweighted</code>:</strong></p><pre><code class="language-julia hljs">[1] average_mweighted(dataobject::ContainMassDataSetType, var::Symbol; mask)</code></pre><p>&lt;a id=&quot;Statistics&quot;&gt;&lt;/a&gt;</p><h2 id="Get-Predefined-Quantities"><a class="docs-heading-anchor" href="#Get-Predefined-Quantities">Get Predefined Quantities</a><a id="Get-Predefined-Quantities-1"></a><a class="docs-heading-anchor-permalink" href="#Get-Predefined-Quantities" title="Permalink"></a></h2><p>Here, we only show the examples with the hydro-data:</p><pre><code class="language-julia hljs">info = getinfo(1, &quot;/Volumes/FASTStorage/Simulations/Mera-Tests//manu_stable_2019&quot;, verbose=false);
gas = gethydro(info, [:rho, :vx, :vy, :vz], verbose=false);</code></pre><pre><code class="nohighlight hljs">Processing files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:11 ( 0.37  s/it)
</code></pre><pre><code class="nohighlight hljs">
‚úì File processing complete! Combining results...
  3.499981 seconds (399.56 k allocations: 5.428 GiB, 3.99% gc time)
</code></pre><p>Use <code>getvar</code> to extract variables or derive predefined quantities from the database, dependent on the data type. See the possible variables:</p><pre><code class="language-julia hljs">getvar()</code></pre><pre><code class="nohighlight hljs">Predefined vars that can be calculated for each cell/particle:
----------------------------------------------------------------
=============================[gas]:=============================
       -all the non derived hydro vars-
:cpu, :level, :rho, :cx, :cy, :cz, :vx, :vy, :vz, :p, var6,...

              -derived hydro vars-
:x, :y, :z
:mass, :cellsize, :volume, :freefall_time
:cs, :mach, :machx, :machy, :machz, :jeanslength, :jeansnumber, :jeansmass
:virial_parameter_local
:T, :Temp, :Temperature with p/rho
:etherm (thermal energy per cell)

:entropy_specific (specific entropy)
:entropy_index (dimensionless adiabatic constant)
:entropy_density (entropy per unit volume)
:entropy_per_particle (entropy per particle)
:entropy_total (total entropy per cell/particle)

          -magnetohydrodynamic Mach numbers-
:mach_alfven, :mach_fast, :mach_slow

==========================[particles]:==========================
       -all the non derived particle vars-
:cpu, :level, :id, :family, :tag
:x, :y, :z, :vx, :vy, :vz, :mass, :birth, :metal....

              -derived particle vars-
:age

===========================[gravity]:===========================
       -all the non derived gravity vars-
:cpu, :level, cx, cy, cz, :epot, :ax, :ay, :az

              -derived gravity vars-
:x, :y, :z
:cellsize, :volume

     -gravitational field properties-
:a_magnitude
:escape_speed
:gravitational_redshift
:specific_gravitational_energy

===========================[clumps]:===========================
:peak_x or :x, :peak_y or :y, :peak_z or :z
:v, :ekin,...

=====================[gas, particles or gravity]:=======================
:v, :ekin

related to a given center:
---------------------------
:r_cylinder, :r_sphere (radial distances)
:œï (azimuthal angle)

     -cylindrical velocity components-
:vr_cylinder, :vœï_cylinder

     -spherical velocity components-
:vr_sphere, :vŒ∏_sphere, :vœï_sphere

     -coordinate-dependent Mach numbers-
:mach_r_cylinder, :mach_phi_cylinder
:mach_r_sphere, :mach_theta_sphere, :mach_phi_sphere

     -specific angular momentum-
:h, :hx, :hy, :hz

     -angular momentum-
:l, :lx, :ly, :lz (Cartesian components)
:lr_cylinder, :lœï_cylinder (cylindrical components)
:lr_sphere, :lŒ∏_sphere, :lœï_sphere (spherical components)

     -cylindrical acceleration components, gravity-
:ar_cylinder, :aœï_cylinder

     -spherical acceleration components, gravity-
:ar_sphere, :aŒ∏_sphere, :aœï_sphere
----------------------------------------------------------------
</code></pre><h3 id="Get-a-Single-Quantity"><a class="docs-heading-anchor" href="#Get-a-Single-Quantity">Get a Single Quantity</a><a id="Get-a-Single-Quantity-1"></a><a class="docs-heading-anchor-permalink" href="#Get-a-Single-Quantity" title="Permalink"></a></h3><p>In the following example, we calculate the mass for each cell of the hydro data.</p><ul><li>The output is a 1dim array in code units by default (mass1).</li><li>Each element/cell can be scaled to Msol units by the elementwise multiplikation <strong>gas.scale.Msol</strong> (mass2).</li><li>The <code>getvar</code> function supports intrinsic scaling to a selected unit (mass3).</li><li>The selected unit does not need a keyword argument if the following order is maintained: dataobject, variable, unit</li></ul><pre><code class="language-julia hljs">mass1 = getvar(gas, :mass) # [code units]
mass2 = getvar(gas, :mass) * gas.scale.Msol # scale the result (1dim array) from code units to solar masses
mass3 = getvar(gas, :mass, unit=:Msol) # unit calculation, provided by a keyword argument [Msol]
mass4 = getvar(gas, :mass, :Msol) # unit calculation provided by an argument [Msol]

# construct a three dimensional array to compare the three created arrays column wise:
mass_overview = ass1 mass2 mass3 mass4]</code></pre><pre><code class="nohighlight hljs">37898393√ó4 Matrix{Float64}:
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 8.9407e-7   894.07     894.07     894.07
 ‚ãÆ
 1.02889e-7  102.889    102.889    102.889
 1.02889e-7  102.889    102.889    102.889
 1.94423e-7  194.423    194.423    194.423
 1.94423e-7  194.423    194.423    194.423
 8.90454e-8   89.0454    89.0454    89.0454
 8.90454e-8   89.0454    89.0454    89.0454
 2.27641e-8   22.7641    22.7641    22.7641
 2.27641e-8   22.7641    22.7641    22.7641
 8.42157e-9    8.42157    8.42157    8.42157
 8.42157e-9    8.42157    8.42157    8.42157
 3.65085e-8   36.5085    36.5085    36.5085
 3.65085e-8   36.5085    36.5085    36.5085</code></pre><p>Furthermore, we provide a simple function to get the mass of each cell in code units:</p><h3 id="Available-Methods"><a class="docs-heading-anchor" href="#Available-Methods">Available Methods</a><a id="Available-Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Available-Methods" title="Permalink"></a></h3><p>To see all available methods for the <code>msum</code> function, we can use Julia&#39;s introspection:</p><pre><code class="language-julia hljs">methods(msum)</code></pre><p><strong>Available methods for <code>msum</code>:</strong></p><pre><code class="language-julia hljs">[1] msum(dataobject::ContainMassDataSetType; unit, mask)
[2] msum(dataobject::ContainMassDataSetType, unit::Symbol; mask)</code></pre><h3 id="Get-Multiple-Quantities"><a class="docs-heading-anchor" href="#Get-Multiple-Quantities">Get Multiple Quantities</a><a id="Get-Multiple-Quantities-1"></a><a class="docs-heading-anchor-permalink" href="#Get-Multiple-Quantities" title="Permalink"></a></h3><p>Get several quantities with one function call by passing an array containing the selected variables. <code>getvar</code> returns a dictionary containing 1dim arrays for each quantity in code units:</p><pre><code class="language-julia hljs"># Display methods in a Documenter.jl friendly format
println(&quot;Available methods for center_of_mass:&quot;)
println(&quot;‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ&quot;)
for m in methods(center_of_mass)
    println(&quot;‚Ä¢ &quot;, m)
end</code></pre><pre><code class="nohighlight hljs">Available methods for center_of_mass:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ center_of_mass(dataobject::Vector{HydroPartType}; unit, mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:244
‚Ä¢ center_of_mass(dataobject::Vector{HydroPartType}, unit::Symbol; mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:240
‚Ä¢ center_of_mass(dataobject::ContainMassDataSetType; unit, mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:121
‚Ä¢ center_of_mass(dataobject::ContainMassDataSetType, unit::Symbol; mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:117
</code></pre><p>The units for each quantity can by passed as an array to the keyword argument &quot;units&quot; (plural, compare with single quantitiy call above) by preserving the order of the vars argument:</p><pre><code class="language-julia hljs"># Display methods in a Documenter.jl friendly format
println(&quot;Available methods for com:&quot;)
println(&quot;‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ&quot;)
for m in methods(com)
    println(&quot;‚Ä¢ &quot;, m)
end</code></pre><pre><code class="nohighlight hljs">Available methods for com:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ com(dataobject::Vector{HydroPartType}; unit, mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:311
‚Ä¢ com(dataobject::Vector{HydroPartType}, unit::Symbol; mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:307
‚Ä¢ com(dataobject::ContainMassDataSetType; unit, mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:160
‚Ä¢ com(dataobject::ContainMassDataSetType, unit::Symbol; mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:156
</code></pre><p>The function can be called without any keywords by preserving the following order: dataobject, variables, units</p><pre><code class="language-julia hljs">quantities = getvar(gas, [:mass, :ekin], [:Msol, :erg])</code></pre><pre><code class="nohighlight hljs">Dict{Any, Any} with 2 entries:
  :mass =&gt; [894.07, 894.07, 894.07, 894.07, 894.07, 894.07, 894.07, 894.07, 894‚Ä¶
  :ekin =&gt; [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  ‚Ä¶  1.95354e49, 1.‚Ä¶</code></pre><p>The arrays of the single quantities can be accessed from the dictionary:</p><pre><code class="language-julia hljs"># Display methods in a Documenter.jl friendly format
println(&quot;Available methods for bulk_velocity:&quot;)
println(&quot;‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ&quot;)
for m in methods(bulk_velocity)
    println(&quot;‚Ä¢ &quot;, m)
end</code></pre><pre><code class="nohighlight hljs">Available methods for bulk_velocity:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ bulk_velocity(dataobject::ContainMassDataSetType; unit, weighting, mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:434
‚Ä¢ bulk_velocity(dataobject::ContainMassDataSetType, unit::Symbol; weighting, mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:429
</code></pre><p>If all selected variables should be of the same unit use the following arguments: dataobject, array of quantities, unit (no array needed):</p><pre><code class="language-julia hljs"># Display methods in a Documenter.jl friendly format
println(&quot;Available methods for average_velocity:&quot;)
println(&quot;‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ&quot;)
for m in methods(average_velocity)
    println(&quot;‚Ä¢ &quot;, m)
end</code></pre><pre><code class="nohighlight hljs">Available methods for average_velocity:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ average_velocity(dataobject::ContainMassDataSetType; unit, weighting, mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:485
‚Ä¢ average_velocity(dataobject::ContainMassDataSetType, unit::Symbol; weighting, mask) @ Mera ~/Documents/codes/github/Mera.jl/src/functions/basic_calc.jl:481
</code></pre><h3 id="Get-Quantities-related-to-a-center"><a class="docs-heading-anchor" href="#Get-Quantities-related-to-a-center">Get Quantities related to a center</a><a id="Get-Quantities-related-to-a-center-1"></a><a class="docs-heading-anchor-permalink" href="#Get-Quantities-related-to-a-center" title="Permalink"></a></h3><p>Some quantities are related to a given center, e.g. radius in cylindrical coordinates, see the overview :</p><pre><code class="language-julia hljs">getvar()</code></pre><pre><code class="nohighlight hljs">Predefined vars that can be calculated for each cell/particle:
----------------------------------------------------------------
=============================[gas]:=============================
       -all the non derived hydro vars-
:cpu, :level, :rho, :cx, :cy, :cz, :vx, :vy, :vz, :p, var6,...

              -derived hydro vars-
:x, :y, :z
:mass, :cellsize, :volume, :freefall_time
:cs, :mach, :machx, :machy, :machz, :jeanslength, :jeansnumber, :jeansmass
:virial_parameter_local
:T, :Temp, :Temperature with p/rho
:etherm (thermal energy per cell)

:entropy_specific (specific entropy)
:entropy_index (dimensionless adiabatic constant)
:entropy_density (entropy per unit volume)
:entropy_per_particle (entropy per particle)
:entropy_total (total entropy per cell/particle)

          -magnetohydrodynamic Mach numbers-
:mach_alfven, :mach_fast, :mach_slow

==========================[particles]:==========================
       -all the non derived particle vars-
:cpu, :level, :id, :family, :tag
:x, :y, :z, :vx, :vy, :vz, :mass, :birth, :metal....

              -derived particle vars-
:age

===========================[gravity]:===========================
       -all the non derived gravity vars-
:cpu, :level, cx, cy, cz, :epot, :ax, :ay, :az

              -derived gravity vars-
:x, :y, :z
:cellsize, :volume

     -gravitational field properties-
:a_magnitude
:escape_speed
:gravitational_redshift
:specific_gravitational_energy

===========================[clumps]:===========================
:peak_x or :x, :peak_y or :y, :peak_z or :z
:v, :ekin,...

=====================[gas, particles or gravity]:=======================
:v, :ekin

related to a given center:
---------------------------
:r_cylinder, :r_sphere (radial distances)
:œï (azimuthal angle)

     -cylindrical velocity components-
:vr_cylinder, :vœï_cylinder

     -spherical velocity components-
:vr_sphere, :vŒ∏_sphere, :vœï_sphere

     -coordinate-dependent Mach numbers-
:mach_r_cylinder, :mach_phi_cylinder
:mach_r_sphere, :mach_theta_sphere, :mach_phi_sphere

     -specific angular momentum-
:h, :hx, :hy, :hz

     -angular momentum-
:l, :lx, :ly, :lz (Cartesian components)
:lr_cylinder, :lœï_cylinder (cylindrical components)
:lr_sphere, :lŒ∏_sphere, :lœï_sphere (spherical components)

     -cylindrical acceleration components, gravity-
:ar_cylinder, :aœï_cylinder

     -spherical acceleration components, gravity-
:ar_sphere, :aŒ∏_sphere, :aœï_sphere
----------------------------------------------------------------
</code></pre><p>The unit of the provided center-array (in cartesian coordinates: x,y.z) is given by the keyword argument <code>center_unit</code> (default: code units). The function returns the quantitites in code units:</p><pre><code class="language-julia hljs">cv = (gas.boxlen / 2.) * gas.scale.kpc # provide the box-center in kpc
# e.g. for :mass the center keyword is ignored
quantities = getvar(gas, [:mass, :r_cylinder], center=[cv, cv, cv], center_unit=:kpc)</code></pre><pre><code class="nohighlight hljs">Dict{Any, Any} with 2 entries:
  :r_cylinder =&gt; [70.1583, 70.1583, 70.1583, 70.1583, 70.1583, 70.1583, 70.1583‚Ä¶
  :mass       =&gt; [8.9407e-7, 8.9407e-7, 8.9407e-7, 8.9407e-7, 8.9407e-7, 8.9407‚Ä¶</code></pre><p>Here, the function returns the result in the units that are provided. Note: E.g. the quantities :mass and :v (velocity) are not affected by the given center.</p><pre><code class="language-julia hljs">quantities = getvar(gas, [:mass, :r_cylinder, :v], units=[:Msol, :kpc, :km_s], center=[cv, cv, cv], center_unit=:kpc)</code></pre><pre><code class="nohighlight hljs">Dict{Any, Any} with 3 entries:
  :r_cylinder =&gt; [70.1583, 70.1583, 70.1583, 70.1583, 70.1583, 70.1583, 70.1583‚Ä¶
  :v          =&gt; [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  ‚Ä¶  100.513,‚Ä¶
  :mass       =&gt; [894.07, 894.07, 894.07, 894.07, 894.07, 894.07, 894.07, 894.0‚Ä¶</code></pre><p>Use the short notation for the box center :bc or :boxcenter for all dimensions (x,y,z). In this case the keyword <code>center_unit</code> is ignored:</p><pre><code class="language-julia hljs">quantities = getvar(gas, [:mass, :r_cylinder, :v], units=[:Msol, :kpc, :km_s], center=[:boxcenter])</code></pre><pre><code class="nohighlight hljs">Dict{Any, Any} with 3 entries:
  :r_cylinder =&gt; [70.1583, 70.1583, 70.1583, 70.1583, 70.1583, 70.1583, 70.1583‚Ä¶
  :v          =&gt; [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  ‚Ä¶  100.513,‚Ä¶
  :mass       =&gt; [894.07, 894.07, 894.07, 894.07, 894.07, 894.07, 894.07, 894.0‚Ä¶</code></pre><pre><code class="language-julia hljs">quantities = getvar(gas, [:mass, :r_cylinder, :v], units=[:Msol, :kpc, :km_s], center=[:bc])</code></pre><pre><code class="nohighlight hljs">Dict{Any, Any} with 3 entries:
  :r_cylinder =&gt; [70.1583, 70.1583, 70.1583, 70.1583, 70.1583, 70.1583, 70.1583‚Ä¶
  :v          =&gt; [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  ‚Ä¶  100.513,‚Ä¶
  :mass       =&gt; [894.07, 894.07, 894.07, 894.07, 894.07, 894.07, 894.07, 894.0‚Ä¶</code></pre><p>Use the box center notation for individual dimensions, here x,z. The keyword <code>center_unit</code> is needed for the y-coordinates:</p><pre><code class="language-julia hljs">quantities = getvar(gas, [:mass, :r_cylinder, :v], units=[:Msol, :kpc, :km_s], center=[:bc, 24., :bc], center_unit=:kpc)</code></pre><pre><code class="nohighlight hljs">Dict{Any, Any} with 3 entries:
  :r_cylinder =&gt; [54.9408, 54.9408, 54.9408, 54.9408, 54.9408, 54.9408, 54.9408‚Ä¶
  :v          =&gt; [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  ‚Ä¶  100.513,‚Ä¶
  :mass       =&gt; [894.07, 894.07, 894.07, 894.07, 894.07, 894.07, 894.07, 894.0‚Ä¶</code></pre><h2 id="Create-Costum-Quantities"><a class="docs-heading-anchor" href="#Create-Costum-Quantities">Create Costum Quantities</a><a id="Create-Costum-Quantities-1"></a><a class="docs-heading-anchor-permalink" href="#Create-Costum-Quantities" title="Permalink"></a></h2><p><strong>Example1:</strong> Represent the positions of the data as the radius for a disk, centred in the simulation box (cylindrical coordinates):</p><pre><code class="language-julia hljs">boxlen = info.boxlen
cv = boxlen / 2. # box-center
levels = getvar(gas, :level) # get the level of each cell
cellsize = boxlen ./ 2 .^levels # calculate the cellsize for each cell (code units)

# or use the predefined quantity
cellsize = getvar(gas, :cellsize)

# convert the cell-number (related to the levels) into positions (code units), relative to the box center
x = getvar(gas, :cx) .* cellsize .- cv # (code units)
y = getvar(gas, :cy) .* cellsize .- cv # (code units)

# or use the predefined quantity
x = getvar(gas, :x, center=[:bc])
y = getvar(gas, :y, center=[:bc])

# calculate the cylindrical radius and scale from code units to kpc
radius = sqrt.(x.^2 .+ y.^2) .* info.scale.kpc</code></pre><pre><code class="nohighlight hljs">37898393-element Vector{Float64}:
 70.15825094589823
 70.15825094589823
 70.15825094589823
 70.15825094589823
 70.15825094589823
 70.15825094589823
 70.15825094589823
 70.15825094589823
 70.15825094589823
 70.15825094589823
 70.15825094589823
 70.15825094589823
 70.15825094589823
  ‚ãÆ
 20.08587520654808
 20.08587520654808
 20.08587520654808
 20.08587520654808
 20.08587520654808
 20.08587520654808
 20.08587520654808
 20.08587520654808
 20.08587520654808
 20.08587520654808
 20.08587520654808
 20.08587520654808</code></pre><h3 id="Use-IndexedTables-Functions"><a class="docs-heading-anchor" href="#Use-IndexedTables-Functions">Use IndexedTables Functions</a><a id="Use-IndexedTables-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Use-IndexedTables-Functions" title="Permalink"></a></h3><p>see <a href="https://juliadb.juliadata.org/stable/">https://juliadb.juliadata.org/stable/</a></p><pre><code class="language-julia hljs">using Mera.IndexedTables</code></pre><p>Example: Get the mass for each gas cell: m<em>i  = œÅ</em>i * cell<em>volume</em>i = œÅ_i * (boxlen / 2^level)^3</p><h4 id="Version-1"><a class="docs-heading-anchor" href="#Version-1">Version 1</a><a id="Version-1-1"></a><a class="docs-heading-anchor-permalink" href="#Version-1" title="Permalink"></a></h4><p>Use the <code>select</code> function and calculate the mass for each cell:</p><pre><code class="language-julia hljs">boxlen = gas.boxlen
level = select(gas.data, :level ) # get level information from each cell
cellvol = (boxlen ./ 2 .^level).^3 # calculate volume for each cell
mass1 = select(gas.data, :rho) .* cellvol .* info.scale.Msol; # calculate the mass for each cell in Msol units</code></pre><h4 id="Version-2"><a class="docs-heading-anchor" href="#Version-2">Version 2</a><a id="Version-2-1"></a><a class="docs-heading-anchor-permalink" href="#Version-2" title="Permalink"></a></h4><p>Use a single time the <code>select</code> function to do the calculations from above :</p><pre><code class="language-julia hljs">mass2 = select( gas.data, (:rho, :level)=&gt;p-&gt;p.rho * (boxlen / 2^p.level)^3 ) .* info.scale.Msol;</code></pre><h4 id="Version-3"><a class="docs-heading-anchor" href="#Version-3">Version 3</a><a id="Version-3-1"></a><a class="docs-heading-anchor-permalink" href="#Version-3" title="Permalink"></a></h4><p>Use the <code>map</code> function to do the calculations from above :</p><pre><code class="language-julia hljs">mass3 = map(p-&gt;p.rho * (boxlen / 2^p.level)^3, gas.data) .* info.scale.Msol;</code></pre><p>Comparison of the results:</p><pre><code class="language-julia hljs">ass1 mass2 mass3]</code></pre><pre><code class="nohighlight hljs">37898393√ó3 Matrix{Float64}:
 894.07     894.07     894.07
 894.07     894.07     894.07
 894.07     894.07     894.07
 894.07     894.07     894.07
 894.07     894.07     894.07
 894.07     894.07     894.07
 894.07     894.07     894.07
 894.07     894.07     894.07
 894.07     894.07     894.07
 894.07     894.07     894.07
 894.07     894.07     894.07
 894.07     894.07     894.07
 894.07     894.07     894.07
   ‚ãÆ
 102.889    102.889    102.889
 102.889    102.889    102.889
 194.423    194.423    194.423
 194.423    194.423    194.423
  89.0454    89.0454    89.0454
  89.0454    89.0454    89.0454
  22.7641    22.7641    22.7641
  22.7641    22.7641    22.7641
   8.42157    8.42157    8.42157
   8.42157    8.42157    8.42157
  36.5085    36.5085    36.5085
  36.5085    36.5085    36.5085</code></pre><h2 id="Statistical-Analysis"><a class="docs-heading-anchor" href="#Statistical-Analysis">Statistical Analysis</a><a id="Statistical-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Statistical-Analysis" title="Permalink"></a></h2><p>Statistical analysis provides essential insights into the distribution and characteristics of simulation data. MERA&#39;s <code>wstat</code> function offers comprehensive statistical calculations with support for both unweighted and mass-weighted analysis across all data types.</p><h3 id="Key-Features"><a class="docs-heading-anchor" href="#Key-Features">Key Features</a><a id="Key-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Key-Features" title="Permalink"></a></h3><ul><li><strong>Comprehensive Statistics</strong>: Mean, median, standard deviation, min/max, quartiles, and more</li><li><strong>Weighted Analysis</strong>: Mass-weighted, volume-weighted, or custom weighting schemes</li><li><strong>Multi-Physics Support</strong>: Consistent interface across hydro, particle, and clump data</li><li><strong>Memory Efficient</strong>: Optimized calculations for large datasets</li><li><strong>Physical Units</strong>: Automatic unit conversion for all statistical quantities</li></ul><h3 id="Statistical-Quantities-Available"><a class="docs-heading-anchor" href="#Statistical-Quantities-Available">Statistical Quantities Available</a><a id="Statistical-Quantities-Available-1"></a><a class="docs-heading-anchor-permalink" href="#Statistical-Quantities-Available" title="Permalink"></a></h3><p>The <code>wstat</code> function returns a structured object containing:</p><ul><li><strong>mean</strong>: Arithmetic or weighted mean</li><li><strong>median</strong>: 50th percentile value</li><li><strong>std</strong>: Standard deviation</li><li><strong>min/max</strong>: Extreme values</li><li><strong>q25/q75</strong>: 25th and 75th percentiles</li><li><strong>count</strong>: Number of data points</li></ul><h3 id="Quick-Reference-2"><a class="docs-heading-anchor" href="#Quick-Reference-2">Quick Reference</a><a class="docs-heading-anchor-permalink" href="#Quick-Reference-2" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Unweighted statistics
stats = wstat(getvar(data, :variable, :unit))

# Weighted statistics
stats = wstat(getvar(data, :variable, :unit), weight=getvar(data, :mass))

# Access results
println(&quot;Mean: &quot;, stats.mean)
println(&quot;Std:  &quot;, stats.std)
println(&quot;Range: &quot;, stats.min, &quot; to &quot;, stats.max)</code></pre><pre><code class="language-julia hljs">info = getinfo(400, &quot;/Volumes/FASTStorage/Simulations/Mera-Tests/manu_sim_sf_L14&quot;, verbose=false);
gas       = gethydro(info, [:rho, :vx, :vy, :vz], lmax=8, smallr=1e-5, verbose=false);
particles = getparticles(info, [:mass, :vx, :vy, :vz], verbose=false)
clumps    = getclumps(info, verbose=false);</code></pre><pre><code class="nohighlight hljs">Processing files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:39 (19.37 ms/it)
</code></pre><pre><code class="nohighlight hljs">
‚úì File processing complete! Combining results...
  0.037493 seconds (52.20 k allocations: 123.612 MiB)
</code></pre><p>Pass any kind of Array{&lt;:Real,1} (Float, Integer,...) to the <code>wstat</code> function to get several unweighted statistical quantities at once:</p><pre><code class="language-julia hljs">stats_gas       = wstat( getvar(gas,       :vx,     :km_s)     )
stats_particles = wstat( getvar(particles, :vx,     :km_s)     )
stats_clumps    = wstat( getvar(clumps,    :rho_av, :Msol_pc3) );</code></pre><p>The result is an object that contains several fields with the statistical quantities:</p><pre><code class="language-julia hljs">println( typeof(stats_gas) )
println( typeof(stats_particles) )
println( typeof(stats_clumps) )
propertynames(stats_gas)</code></pre><pre><code class="nohighlight hljs">Mera.WStatType
Mera.WStatType
Mera.WStatType
</code></pre><pre><code class="nohighlight hljs">(:mean, :median, :std, :skewness, :kurtosis, :min, :max)</code></pre><pre><code class="language-julia hljs">println( &quot;Gas        &lt;vx&gt;_allcells     : &quot;,  stats_gas.mean,       &quot; km/s&quot; )
println( &quot;Particles  &lt;vx&gt;_allparticles : &quot;,  stats_particles.mean, &quot; km/s&quot; )
println( &quot;Clumps &lt;rho_av&gt;_allclumps    : &quot;,  stats_clumps.mean,    &quot; Msol/pc^3&quot; )</code></pre><pre><code class="nohighlight hljs">Gas        &lt;vx&gt;_allcells     : -2.931877465071372 km/s
Particles  &lt;vx&gt;_allparticles : -11.594477384589647 km/s
Clumps &lt;rho_av&gt;_allclumps    : 594.7315900915924 Msol/pc^3
</code></pre><pre><code class="language-julia hljs">println( &quot;Gas        min/max_allcells     : &quot;,  stats_gas.min,      &quot;/&quot;, stats_gas.max,       &quot; km/s&quot; )
println( &quot;Particles  min/max_allparticles : &quot;,  stats_particles.min,&quot;/&quot;, stats_particles.max, &quot; km/s&quot; )
println( &quot;Clumps     min/max_allclumps    : &quot;,  stats_clumps.min,   &quot;/&quot;, stats_clumps.max,    &quot; Msol/pc^3&quot; )</code></pre><pre><code class="nohighlight hljs">Gas        min/max_allcells     : -676.5464963488397/894.9181733956399 km/s
Particles  min/max_allparticles : -874.6440509326601/670.7956741234592 km/s
Clumps     min/max_allclumps    : 125.4809686796669/5357.370234867635 Msol/pc^3
</code></pre><h2 id="Weighted-Statistics"><a class="docs-heading-anchor" href="#Weighted-Statistics">Weighted Statistics</a><a id="Weighted-Statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Weighted-Statistics" title="Permalink"></a></h2><p>Pass any kind of Array{&lt;:Real,1} (Float, Integer,...) for the given variables and one for the weighting with the same length. The weighting goes cell by cell, particle by particle, clump by clump, etc...:</p><pre><code class="language-julia hljs">stats_gas       = wstat( getvar(gas,       :vx,     :km_s), weight=getvar(gas,       :mass  ));
stats_particles = wstat( getvar(particles, :vx,     :km_s), weight=getvar(particles, :mass   ));
stats_clumps    = wstat( getvar(clumps,    :peak_x, :kpc ), weight=getvar(clumps,    :mass_cl))  ;</code></pre><p>Without the keyword <code>weight</code> the following order for the given arrays has to be maintained: values, weight</p><pre><code class="language-julia hljs">stats_gas       = wstat( getvar(gas,       :vx,     :km_s), getvar(gas,       :mass  ));
stats_particles = wstat( getvar(particles, :vx,     :km_s), getvar(particles, :mass   ));
stats_clumps    = wstat( getvar(clumps,    :peak_x, :kpc ), getvar(clumps,    :mass_cl))  ;</code></pre><pre><code class="language-julia hljs">propertynames(stats_gas)</code></pre><pre><code class="nohighlight hljs">(:mean, :median, :std, :skewness, :kurtosis, :min, :max)</code></pre><pre><code class="language-julia hljs">println( &quot;Gas        &lt;vx&gt;_allcells     : &quot;,  stats_gas.mean,       &quot; km/s (mass weighted)&quot; )
println( &quot;Particles  &lt;vx&gt;_allparticles : &quot;,  stats_particles.mean, &quot; km/s (mass weighted)&quot; )
println( &quot;Clumps &lt;peak_x&gt;_allclumps    : &quot;,  stats_clumps.mean,    &quot; kpc  (mass weighted)&quot; )</code></pre><pre><code class="nohighlight hljs">Gas        &lt;vx&gt;_allcells     : -1.1999253584798235 km/s (mass weighted)
Particles  &lt;vx&gt;_allparticles : -11.623422700314565 km/s (mass weighted)
Clumps &lt;peak_x&gt;_allclumps    : 23.135765457064576 kpc  (mass weighted)
</code></pre><pre><code class="language-julia hljs">println( &quot;Gas        min/max_allcells     : &quot;,  stats_gas.min,      &quot;/&quot;, stats_gas.max,       &quot; km/s&quot; )
println( &quot;Particles  min/max_allparticles : &quot;,  stats_particles.min,&quot;/&quot;, stats_particles.max, &quot; km/s&quot; )
println( &quot;Clumps     min/max_allclumps    : &quot;,  stats_clumps.min,   &quot;/&quot;, stats_clumps.max,    &quot; Msol/pc^3&quot; )</code></pre><pre><code class="nohighlight hljs">Gas        min/max_allcells     : -676.5464963488397/894.9181733956399 km/s
Particles  min/max_allparticles : -874.6440509326601/670.7956741234592 km/s
Clumps     min/max_allclumps    : 10.29199219000667/38.17382813002474 Msol/pc^3
</code></pre><p>For the average of the gas-density use volume weighting:</p><pre><code class="language-julia hljs">stats_gas = wstat( getvar(gas, :rho, :g_cm3), weight=getvar(gas, :volume) );</code></pre><pre><code class="language-julia hljs">println( &quot;Gas  &lt;rho&gt;_allcells : &quot;,  stats_gas.mean,  &quot; g/cm^3 (volume weighted)&quot; )</code></pre><pre><code class="nohighlight hljs">Gas  &lt;rho&gt;_allcells : 1.8958545012297404e-26 g/cm^3 (volume weighted)
</code></pre><h2 id="Helpful-Functions"><a class="docs-heading-anchor" href="#Helpful-Functions">Helpful Functions</a><a id="Helpful-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Helpful-Functions" title="Permalink"></a></h2><p>Get the x,y,z positions of every cell relative to a given center:</p><pre><code class="language-julia hljs">x,y,z = getpositions(gas, :kpc, center=[24.,24.,24.], center_unit=:kpc); # returns a Tuple of 3 arrays</code></pre><p>The box-center can be calculated automatically:</p><pre><code class="language-julia hljs">x,y,z = getpositions(gas, :kpc, center=[:boxcenter]);</code></pre><pre><code class="language-julia hljs">[x y z] # preview of the output</code></pre><pre><code class="nohighlight hljs">849332√ó3 Matrix{Float64}:
 -23.25   -23.25    -23.25
 -23.25   -23.25    -22.5
 -23.25   -23.25    -21.75
 -23.25   -23.25    -21.0
 -23.25   -23.25    -20.25
 -23.25   -23.25    -19.5
 -23.25   -23.25    -18.75
 -23.25   -23.25    -18.0
 -23.25   -23.25    -17.25
 -23.25   -23.25    -16.5
 -23.25   -23.25    -15.75
 -23.25   -23.25    -15.0
 -23.25   -23.25    -14.25
   ‚ãÆ
  16.125    3.9375    0.1875
  16.125    3.9375    0.375
  16.125    3.9375    0.5625
  16.125    3.9375    0.75
  16.125    4.125    -0.5625
  16.125    4.125    -0.375
  16.125    4.125    -0.1875
  16.125    4.125     0.0
  16.125    4.125     0.1875
  16.125    4.125     0.375
  16.125    4.125     0.5625
  16.125    4.125     0.75</code></pre><p>Get the extent of the dataset-domain:</p><pre><code class="language-julia hljs">getextent(gas) # returns Tuple of (xmin, xmax), (ymin ,ymax ), (zmin ,zmax )</code></pre><pre><code class="nohighlight hljs">((0.0, 48.0), (0.0, 48.0), (0.0, 48.0))</code></pre><p>Get the extent relative to a given center:</p><pre><code class="language-julia hljs">getextent(gas, center=[:boxcenter])</code></pre><pre><code class="nohighlight hljs">((-24.0, 24.0), (-24.0, 24.0), (-24.0, 24.0))</code></pre><p>Get simulation time in code unit oder physical unit</p><pre><code class="language-julia hljs">gettime(info)</code></pre><pre><code class="nohighlight hljs">39.9019537349027</code></pre><pre><code class="language-julia hljs">gettime(info, :Myr)</code></pre><pre><code class="nohighlight hljs">594.9774920106152</code></pre><pre><code class="language-julia hljs">gettime(gas, :Myr)</code></pre><pre><code class="nohighlight hljs">594.9774920106152</code></pre><h2 id="Summary"><a class="docs-heading-anchor" href="#Summary">Summary</a><a id="Summary-1"></a><a class="docs-heading-anchor-permalink" href="#Summary" title="Permalink"></a></h2><p>This tutorial demonstrated MERA&#39;s powerful capabilities for basic calculations and statistical analysis across multi-physics simulation data. The unified interface enables seamless analysis of hydro, particle, and clump data with consistent syntax and automatic unit handling.</p><h3 id="Key-Takeaways"><a class="docs-heading-anchor" href="#Key-Takeaways">Key Takeaways</a><a id="Key-Takeaways-1"></a><a class="docs-heading-anchor-permalink" href="#Key-Takeaways" title="Permalink"></a></h3><h4 id="Essential-Functions-Covered"><a class="docs-heading-anchor" href="#Essential-Functions-Covered">Essential Functions Covered</a><a id="Essential-Functions-Covered-1"></a><a class="docs-heading-anchor-permalink" href="#Essential-Functions-Covered" title="Permalink"></a></h4><ul><li><strong><code>msum</code></strong>: Mass summation with automatic unit conversion</li><li><strong><code>center_of_mass</code></strong>: Mass-weighted spatial averaging</li><li><strong><code>bulk_velocity</code></strong>: Mass-weighted velocity centroids</li><li><strong><code>wstat</code></strong>: Comprehensive statistical analysis with weighting options</li><li><strong><code>getvar</code></strong>: Flexible variable extraction with unit conversion</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../api/subregions/">¬´ API Reference</a><a class="docs-footer-nextpage" href="../api/calculations/">API Reference ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 18 August 2025 17:31">Monday 18 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
