<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API Reference · Mera.jl</title><meta name="title" content="API Reference · Mera.jl"/><meta property="og:title" content="API Reference · Mera.jl"/><meta property="twitter:title" content="API Reference · Mera.jl"/><meta name="description" content="Documentation for Mera.jl."/><meta property="og:description" content="Documentation for Mera.jl."/><meta property="twitter:description" content="Documentation for Mera.jl."/><meta property="og:url" content="https://manuelbehrendt.github.io/Mera.jl/api/multithreading/"/><meta property="twitter:url" content="https://manuelbehrendt.github.io/Mera.jl/api/multithreading/"/><link rel="canonical" href="https://manuelbehrendt.github.io/Mera.jl/api/multithreading/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/><script src="../../assets/custom.js"></script><script src="../../assets/music_player.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Mera.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../00_multi_FirstSteps/">Getting Started</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Core Workflows</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Data Inspection</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../01_hydro_First_Inspection/">Hydro</a></li><li><a class="tocitem" href="../../01_particles_First_Inspection/">Particles</a></li><li><a class="tocitem" href="../../01_clumps_First_Inspection/">Clumps</a></li><li><a class="tocitem" href="../data_inspection/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Load by Selection</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../02_hydro_Load_Selections/">Hydro</a></li><li><a class="tocitem" href="../../02_particles_Load_Selections/">Particles</a></li><li><a class="tocitem" href="../../02_clumps_Load_Selections/">Clumps</a></li><li><a class="tocitem" href="../data_loading/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Get Subregions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../03_hydro_Get_Subregions/">Hydro</a></li><li><a class="tocitem" href="../../03_particles_Get_Subregions/">Particles</a></li><li><a class="tocitem" href="../../03_clumps_Get_Subregions/">Clumps</a></li><li><a class="tocitem" href="../subregions/">API Reference</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Analysis &amp; Calculations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Basic Calculations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../04_multi_Basic_Calculations/">Tutorial</a></li><li><a class="tocitem" href="../calculations/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Mask/Filter/Meta</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../05_multi_Masking_Filtering/">Tutorial</a></li><li><a class="tocitem" href="../masking_filtering/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Projection</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../06_hydro_Projection/">Hydro</a></li><li><a class="tocitem" href="../../06_particles_Projection/">Particles</a></li><li><a class="tocitem" href="../projections/">API Reference</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Data &amp; Visualization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">MERA-Files</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../07_multi_Mera_Files/">Mera-Files</a></li><li><a class="tocitem" href="../../07_1_multi_Mera_Files_Converter/">Converter</a></li><li><a class="tocitem" href="../mera_files/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Volume Rendering</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../paraview/paraview_intro/">Intro</a></li><li><a class="tocitem" href="../../paraview/08_hydro_VTK_export/">Hydro</a></li><li><a class="tocitem" href="../../paraview/08_particles_VTK_export/">Particles</a></li><li><a class="tocitem" href="../volume_rendering/">API Reference</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox" checked/><label class="tocitem" for="menuitem-6"><span class="docs-label">Advanced Features</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox" checked/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">Multi-Threading</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../multi-threading/multi-threading_intro/">Tutorial</a></li><li class="is-active"><a class="tocitem" href>API Reference</a><ul class="internal"><li><a class="tocitem" href="#Quick-Threading-Reference"><span>Quick Threading Reference</span></a></li><li><a class="tocitem" href="#Threading-Information-Functions"><span>Threading Information Functions</span></a></li><li><a class="tocitem" href="#Performance-Benchmarking"><span>Performance Benchmarking</span></a></li><li><a class="tocitem" href="#Progress-Tracking"><span>Progress Tracking</span></a></li><li><a class="tocitem" href="#Threading-Control-Parameters"><span>Threading Control Parameters</span></a></li><li><a class="tocitem" href="#Threading-Patterns-Reference"><span>Threading Patterns Reference</span></a></li><li><a class="tocitem" href="#Thread-Safety-Guidelines"><span>Thread Safety Guidelines</span></a></li><li><a class="tocitem" href="#Performance-Optimization"><span>Performance Optimization</span></a></li><li><a class="tocitem" href="#Troubleshooting"><span>Troubleshooting</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../advanced_features/testing_guide/">Testing Framework</a></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">Notifications</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../notifications/">Overview</a></li><li><a class="tocitem" href="../../notifications/01_quick_start/">Quick Start</a></li><li><a class="tocitem" href="../../notifications/02_setup/">Setup Guide</a></li><li><a class="tocitem" href="../../notifications/bell/">Bell (Local Audio)</a></li><li><a class="tocitem" href="../../notifications/email/">Email</a></li><li><a class="tocitem" href="../../notifications/zulip/">Zulip (Team Chat)</a></li><li><a class="tocitem" href="../../notifications/zulip_templates/">Zulip Templates</a></li><li><a class="tocitem" href="../../notifications/03_attachments/">File Attachments</a></li><li><a class="tocitem" href="../../notifications/04_output_capture/">Output Capture</a></li><li><a class="tocitem" href="../../notifications/05_advanced/">Advanced Features</a></li><li><a class="tocitem" href="../../notifications/06_examples/">Examples</a></li><li><a class="tocitem" href="../../notifications/07_troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../notifications/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-4" type="checkbox"/><label class="tocitem" for="menuitem-6-4"><span class="docs-label">Benchmarks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../benchmarks/IO/IOperformance/">Server IO</a></li><li><a class="tocitem" href="../../benchmarks/RAMSES_reading/ramses_reading/">Parallel RAMSES-Files Reading</a></li><li><a class="tocitem" href="../../benchmarks/JLD2_reading/Mera_files_reading/">Mera-Files Reading</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Julia Quick Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../quickreference/01_getting_started/">Getting Started</a></li><li><a class="tocitem" href="../../quickreference/02_migrators/">From Other Languages</a></li><li><a class="tocitem" href="../../quickreference/03_packages/">Essential Packages</a></li><li><a class="tocitem" href="../../quickreference/04_mera_patterns/">Julia Fundamentals</a></li><li><a class="tocitem" href="../../quickreference/05_performance/">Performance &amp; Debugging</a></li><li><a class="tocitem" href="../../quickreference/06_resources/">Resources &amp; Community</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Examples &amp; Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/">Examples</a></li><li><a class="tocitem" href="../../Miscellaneous/">Miscellaneous</a></li><li><a class="tocitem" href="../">Complete API Reference</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Advanced Features</a></li><li><a class="is-disabled">Multi-Threading</a></li><li class="is-active"><a href>API Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API Reference</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ManuelBehrendt/Mera.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Multi-Threading-API-Reference"><a class="docs-heading-anchor" href="#Multi-Threading-API-Reference">Multi-Threading API Reference</a><a id="Multi-Threading-API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-Threading-API-Reference" title="Permalink"></a></h1><p><img src="../../assets/representtative_multithreading_60.png" alt="MERA.jl Multi-Threading Performance"/></p><p><em>High-performance parallel computing with MERA.jl: leveraging multi-core processors for accelerated astrophysical data analysis</em></p><p>Comprehensive reference for Mera&#39;s parallel processing functions and threading control.</p><h2 id="Quick-Threading-Reference"><a class="docs-heading-anchor" href="#Quick-Threading-Reference">Quick Threading Reference</a><a id="Quick-Threading-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Threading-Reference" title="Permalink"></a></h2><h3 id="Core-Functions"><a class="docs-heading-anchor" href="#Core-Functions">Core Functions</a><a id="Core-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Core-Functions" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Threading setup and diagnostics
show_threading_info()           # Display threading configuration

# Performance benchmarking  
benchmark_projection_hydro(gas, [1,2,4,8])  # Test thread performance

# Progress tracking for long operations
tracker = create_progress_tracker(100)      # Create progress tracker
update_progress!(tracker, 50)               # Update to 50% complete
complete_progress!(tracker)                  # Mark as finished</code></pre><h3 id="Key-Parameters"><a class="docs-heading-anchor" href="#Key-Parameters">Key Parameters</a><a id="Key-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Key-Parameters" title="Permalink"></a></h3><table><tr><th style="text-align: right">Parameter</th><th style="text-align: right">Type</th><th style="text-align: right">Purpose</th><th style="text-align: right">Default</th></tr><tr><td style="text-align: right"><code>max_threads</code></td><td style="text-align: right"><code>Int</code></td><td style="text-align: right">Limit concurrent threads</td><td style="text-align: right"><code>Threads.nthreads()</code></td></tr><tr><td style="text-align: right"><code>verbose_threads</code></td><td style="text-align: right"><code>Bool</code></td><td style="text-align: right">Show threading diagnostics</td><td style="text-align: right"><code>false</code></td></tr></table><hr/><h2 id="Threading-Information-Functions"><a class="docs-heading-anchor" href="#Threading-Information-Functions">Threading Information Functions</a><a id="Threading-Information-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Threading-Information-Functions" title="Permalink"></a></h2><h3 id="show_threading_info()"><a class="docs-heading-anchor" href="#show_threading_info()"><code>show_threading_info()</code></a><a id="show_threading_info()-1"></a><a class="docs-heading-anchor-permalink" href="#show_threading_info()" title="Permalink"></a></h3><p>Display comprehensive threading configuration and recommendations.</p><p><strong>Purpose:</strong></p><ul><li>Check current Julia threading setup</li><li>Get performance recommendations  </li><li>Troubleshoot threading issues</li></ul><p><strong>Returns:</strong> <code>Nothing</code> (prints information)</p><p><strong>Example:</strong></p><pre><code class="language-julia hljs">using Mera
show_threading_info()
# Output:
# 🧵 JULIA THREADING INFORMATION
# ===============================
# Available threads: 8
# CPU cores: 8
# ✅ Multi-threading enabled
# 
# 🚀 PERFORMANCE RECOMMENDATIONS
# ==============================
# Variable-based parallel processing:
#   • 2+ variables: Automatic variable-based parallelization
#   • Single variable: Optimized sequential processing
#   • Threading scales linearly with variable count</code></pre><p><strong>When to use:</strong></p><ul><li>Before starting threading-intensive work</li><li>When experiencing performance issues</li><li>To verify Julia was started with threading enabled</li></ul><hr/><h2 id="Performance-Benchmarking"><a class="docs-heading-anchor" href="#Performance-Benchmarking">Performance Benchmarking</a><a id="Performance-Benchmarking-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Benchmarking" title="Permalink"></a></h2><h3 id="benchmark_projection_hydro(gas_data,-thread_counts,-n_runs10,-output_file&quot;&quot;)"><a class="docs-heading-anchor" href="#benchmark_projection_hydro(gas_data,-thread_counts,-n_runs10,-output_file&quot;&quot;)"><code>benchmark_projection_hydro(gas_data, thread_counts, n_runs=10, output_file=&quot;&quot;)</code></a><a id="benchmark_projection_hydro(gas_data,-thread_counts,-n_runs10,-output_file&quot;&quot;)-1"></a><a class="docs-heading-anchor-permalink" href="#benchmark_projection_hydro(gas_data,-thread_counts,-n_runs10,-output_file&quot;&quot;)" title="Permalink"></a></h3><p>Benchmark projection performance across different thread counts to find optimal settings.</p><p><strong>Arguments:</strong></p><ul><li><code>gas_data</code>: Hydro data object from <code>gethydro()</code></li><li><code>thread_counts</code>: Vector of thread counts to test (e.g., <code>[1,2,4,8]</code>)</li><li><code>n_runs</code>: Number of benchmark runs per thread count (default: 10)</li><li><code>output_file</code>: Optional file to save results (default: auto-generated)</li></ul><p><strong>Returns:</strong> Performance results and creates benchmark report</p><p><strong>Example:</strong></p><pre><code class="language-julia hljs">using Mera
info = getinfo(400, &quot;../data&quot;)
gas = gethydro(info; lmax=10)

# Test different thread counts
thread_counts = [1, 2, 4, 8, 16]
benchmark_projection_hydro(gas, thread_counts, 5)

# Output shows optimal thread count for your system</code></pre><p><strong>Performance Analysis:</strong></p><ul><li>Tests projection performance with multiple variables</li><li>Identifies optimal <code>max_threads</code> values</li><li>Detects resource bottlenecks and contention</li><li>Provides specific recommendations for your hardware</li></ul><p><strong>Interpreting Results:</strong></p><ul><li>Look for thread count with best performance/thread ratio</li><li>Watch for performance degradation at high thread counts</li><li>Consider I/O vs compute-bound characteristics</li></ul><hr/><h2 id="Progress-Tracking"><a class="docs-heading-anchor" href="#Progress-Tracking">Progress Tracking</a><a id="Progress-Tracking-1"></a><a class="docs-heading-anchor-permalink" href="#Progress-Tracking" title="Permalink"></a></h2><p>For long-running multi-threaded operations with optional Zulip notifications.</p><h3 id="create_progress_tracker(total_items;-kwargs...)"><a class="docs-heading-anchor" href="#create_progress_tracker(total_items;-kwargs...)"><code>create_progress_tracker(total_items; kwargs...)</code></a><a id="create_progress_tracker(total_items;-kwargs...)-1"></a><a class="docs-heading-anchor-permalink" href="#create_progress_tracker(total_items;-kwargs...)" title="Permalink"></a></h3><p>Create a progress tracker for monitoring threaded operations.</p><p><strong>Arguments:</strong></p><ul><li><code>total_items</code>: Total number of items to process</li></ul><p><strong>Keyword Arguments:</strong></p><ul><li><code>time_interval</code>: Seconds between time-based notifications (default: 300)</li><li><code>progress_interval</code>: Percentage between progress notifications (default: 10)</li><li><code>task_name</code>: Descriptive name for the task (default: &quot;Processing&quot;)</li><li><code>zulip_channel</code>: Zulip channel for notifications (default: &quot;progress&quot;)</li><li><code>zulip_topic</code>: Zulip topic for notifications (default: &quot;Task Progress&quot;)</li></ul><p><strong>Returns:</strong> Dictionary containing tracker state</p><p><strong>Example:</strong></p><pre><code class="language-julia hljs"># Create tracker for 1000 snapshots
tracker = create_progress_tracker(1000; 
                                 task_name=&quot;Multi-snapshot analysis&quot;,
                                 progress_interval=5)  # Notify every 5%</code></pre><h3 id="update_progress!(tracker,-current_item,-custom_message&quot;&quot;)"><a class="docs-heading-anchor" href="#update_progress!(tracker,-current_item,-custom_message&quot;&quot;)"><code>update_progress!(tracker, current_item, custom_message=&quot;&quot;)</code></a><a id="update_progress!(tracker,-current_item,-custom_message&quot;&quot;)-1"></a><a class="docs-heading-anchor-permalink" href="#update_progress!(tracker,-current_item,-custom_message&quot;&quot;)" title="Permalink"></a></h3><p>Update progress tracker with current status.</p><p><strong>Arguments:</strong></p><ul><li><code>tracker</code>: Tracker dictionary from <code>create_progress_tracker()</code></li><li><code>current_item</code>: Current item number being processed</li><li><code>custom_message</code>: Optional custom status message</li></ul><p><strong>Returns:</strong> <code>Nothing</code> (updates tracker and may send notifications)</p><p><strong>Thread Safety:</strong> Safe to call from multiple threads</p><p><strong>Example:</strong></p><pre><code class="language-julia hljs">@threads for i in 1:1000
    # Process snapshot
    analyze_snapshot(snapshots[i])
    
    # Update progress (thread-safe)
    update_progress!(tracker, i, &quot;Processed snapshot $(snapshots[i])&quot;)
end</code></pre><h3 id="complete_progress!(tracker,-final_message&quot;&quot;;-include_summarytrue)"><a class="docs-heading-anchor" href="#complete_progress!(tracker,-final_message&quot;&quot;;-include_summarytrue)"><code>complete_progress!(tracker, final_message=&quot;&quot;; include_summary=true)</code></a><a id="complete_progress!(tracker,-final_message&quot;&quot;;-include_summarytrue)-1"></a><a class="docs-heading-anchor-permalink" href="#complete_progress!(tracker,-final_message&quot;&quot;;-include_summarytrue)" title="Permalink"></a></h3><p>Mark progress tracking as complete and send final notification.</p><p><strong>Arguments:</strong></p><ul><li><code>tracker</code>: Tracker dictionary</li><li><code>final_message</code>: Custom completion message</li><li><code>include_summary</code>: Include timing summary (default: true)</li></ul><p><strong>Returns:</strong> <code>Nothing</code> (sends completion notification)</p><p><strong>Example:</strong></p><pre><code class="language-julia hljs">complete_progress!(tracker, &quot;Multi-snapshot analysis completed successfully&quot;)</code></pre><hr/><h2 id="Threading-Control-Parameters"><a class="docs-heading-anchor" href="#Threading-Control-Parameters">Threading Control Parameters</a><a id="Threading-Control-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Threading-Control-Parameters" title="Permalink"></a></h2><h3 id="max_threads-Parameter"><a class="docs-heading-anchor" href="#max_threads-Parameter"><code>max_threads</code> Parameter</a><a id="max_threads-Parameter-1"></a><a class="docs-heading-anchor-permalink" href="#max_threads-Parameter" title="Permalink"></a></h3><p>Controls the maximum number of threads used by Mera functions.</p><p><strong>Available in:</strong></p><ul><li><code>gethydro()</code></li><li><code>getgravity()</code> </li><li><code>getparticles()</code></li><li><code>projection()</code></li><li>Most analysis functions</li></ul><p><strong>Usage patterns:</strong></p><pre><code class="language-julia hljs"># Outer-loop parallelism: limit inner threading
@threads for snapshot in snapshots
    gas = gethydro(info; max_threads=1)  # Serial loading
end

# Inner-kernel parallelism: use all threads
gas = gethydro(info)  # Uses Threads.nthreads() by default

# Mixed: controlled allocation
gas = gethydro(info; max_threads=4)      # 4 threads for I/O
proj = projection(gas, vars; max_threads=4)  # 4 threads for compute</code></pre><p><strong>Optimization Guidelines:</strong></p><ul><li>I/O-bound operations: 2-8 threads often optimal</li><li>CPU-bound operations: Match physical cores</li><li>Memory-bound operations: 2-4 threads recommended</li><li>Network storage: Fewer threads usually better</li></ul><h3 id="verbose_threads-Parameter"><a class="docs-heading-anchor" href="#verbose_threads-Parameter"><code>verbose_threads</code> Parameter</a><a id="verbose_threads-Parameter-1"></a><a class="docs-heading-anchor-permalink" href="#verbose_threads-Parameter" title="Permalink"></a></h3><p>Enables detailed threading diagnostics and performance metrics.</p><p><strong>Available in:</strong></p><ul><li><code>projection()</code> functions</li></ul><p><strong>Example:</strong></p><pre><code class="language-julia hljs"># Enable detailed threading diagnostics
proj = projection(gas, [:rho, :T, :vx, :vy]; 
                 verbose_threads=true,
                 max_threads=4)

# Output shows:
# - Thread assignment per variable
# - Load balancing information
# - Per-thread performance metrics
# - Memory allocation patterns</code></pre><p><strong>Diagnostic Output Includes:</strong></p><ul><li>Thread utilization per variable</li><li>Load balancing effectiveness</li><li>Memory allocation per thread</li><li>Execution time breakdown</li><li>Resource contention indicators</li></ul><hr/><h2 id="Threading-Patterns-Reference"><a class="docs-heading-anchor" href="#Threading-Patterns-Reference">Threading Patterns Reference</a><a id="Threading-Patterns-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Threading-Patterns-Reference" title="Permalink"></a></h2><h3 id="Pattern-Selection-Guide"><a class="docs-heading-anchor" href="#Pattern-Selection-Guide">Pattern Selection Guide</a><a id="Pattern-Selection-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Pattern-Selection-Guide" title="Permalink"></a></h3><pre><code class="nohighlight hljs">┌─ Multiple independent tasks? 
│  ├─ Yes → Outer-Loop Pattern
│  └─ No ↓
└─ Single large dataset?
   ├─ Yes → Inner-Kernel Pattern  
   └─ Complex workflow → Mixed Pattern</code></pre><h3 id="Outer-Loop-Pattern"><a class="docs-heading-anchor" href="#Outer-Loop-Pattern">Outer-Loop Pattern</a><a id="Outer-Loop-Pattern-1"></a><a class="docs-heading-anchor-permalink" href="#Outer-Loop-Pattern" title="Permalink"></a></h3><p><strong>Best for:</strong> Multiple snapshots, parameter studies, independent analyses</p><pre><code class="language-julia hljs">@threads for item in work_items
    result = mera_function(item; max_threads=1)
end</code></pre><h3 id="Inner-Kernel-Pattern"><a class="docs-heading-anchor" href="#Inner-Kernel-Pattern">Inner-Kernel Pattern</a><a id="Inner-Kernel-Pattern-1"></a><a class="docs-heading-anchor-permalink" href="#Inner-Kernel-Pattern" title="Permalink"></a></h3><p><strong>Best for:</strong> Single large dataset, multiple variables, complex analysis</p><pre><code class="language-julia hljs">gas = gethydro(info)  # Full threading
proj = projection(gas, multiple_variables)  # Parallel per variable</code></pre><h3 id="Mixed-Pattern"><a class="docs-heading-anchor" href="#Mixed-Pattern">Mixed Pattern</a><a id="Mixed-Pattern-1"></a><a class="docs-heading-anchor-permalink" href="#Mixed-Pattern" title="Permalink"></a></h3><p><strong>Best for:</strong> Controlled resource allocation, complex workflows</p><pre><code class="language-julia hljs">task1 = @spawn mera_function1(data; max_threads=N1)
task2 = @spawn mera_function2(data; max_threads=N2)
results = fetch.([task1, task2])</code></pre><hr/><h2 id="Thread-Safety-Guidelines"><a class="docs-heading-anchor" href="#Thread-Safety-Guidelines">Thread Safety Guidelines</a><a id="Thread-Safety-Guidelines-1"></a><a class="docs-heading-anchor-permalink" href="#Thread-Safety-Guidelines" title="Permalink"></a></h2><h3 id="Safe-Operations"><a class="docs-heading-anchor" href="#Safe-Operations">Safe Operations</a><a id="Safe-Operations-1"></a><a class="docs-heading-anchor-permalink" href="#Safe-Operations" title="Permalink"></a></h3><pre><code class="language-julia hljs"># ✅ Pre-allocated arrays (each thread writes to different index)
results = Vector{Float64}(undef, n)
@threads for i in 1:n
    results[i] = compute(i)
end

# ✅ Atomic operations
total = Atomic{Float64}(0.0)
@threads for i in 1:n
    atomic_add!(total, compute(i))
end

# ✅ Thread-local accumulators
result = @distributed (+) for i in 1:n
    compute(i)
end</code></pre><h3 id="Unsafe-Operations"><a class="docs-heading-anchor" href="#Unsafe-Operations">Unsafe Operations</a><a id="Unsafe-Operations-1"></a><a class="docs-heading-anchor-permalink" href="#Unsafe-Operations" title="Permalink"></a></h3><pre><code class="language-julia hljs"># ❌ Race conditions
total = 0.0
@threads for i in 1:n
    global total += compute(i)  # DANGEROUS
end

# ❌ Shared mutable state without synchronization
shared_dict = Dict()
@threads for i in 1:n
    shared_dict[i] = compute(i)  # DANGEROUS
end</code></pre><hr/><h2 id="Performance-Optimization"><a class="docs-heading-anchor" href="#Performance-Optimization">Performance Optimization</a><a id="Performance-Optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Optimization" title="Permalink"></a></h2><h3 id="Memory-Management"><a class="docs-heading-anchor" href="#Memory-Management">Memory Management</a><a id="Memory-Management-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-Management" title="Permalink"></a></h3><p><strong>Pre-allocation:</strong></p><pre><code class="language-julia hljs"># Good: Allocate once
results = Vector{Float64}(undef, n_items)
@threads for i in 1:n_items
    results[i] = expensive_computation(i)
end</code></pre><p><strong>Garbage Collection:</strong></p><pre><code class="language-julia hljs"># Monitor GC impact
@time threaded_analysis()  # Watch &quot;gc time&quot; percentage

# Reduce allocations
@. output_array = input1 + input2  # In-place operations</code></pre><h3 id="Thread-Utilization"><a class="docs-heading-anchor" href="#Thread-Utilization">Thread Utilization</a><a id="Thread-Utilization-1"></a><a class="docs-heading-anchor-permalink" href="#Thread-Utilization" title="Permalink"></a></h3><p><strong>Check load balancing:</strong></p><pre><code class="language-julia hljs"># Uneven workloads: use @spawn instead of @threads
tasks = [@spawn process_item(item) for item in variable_workload]
results = fetch.(tasks)</code></pre><p><strong>Resource monitoring:</strong></p><pre><code class="language-julia hljs"># Use verbose_threads to identify bottlenecks
proj = projection(gas, vars; verbose_threads=true)
# Look for thread imbalances or resource contention</code></pre><hr/><h2 id="Troubleshooting"><a class="docs-heading-anchor" href="#Troubleshooting">Troubleshooting</a><a id="Troubleshooting-1"></a><a class="docs-heading-anchor-permalink" href="#Troubleshooting" title="Permalink"></a></h2><h3 id="Common-Issues"><a class="docs-heading-anchor" href="#Common-Issues">Common Issues</a><a id="Common-Issues-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Issues" title="Permalink"></a></h3><p><strong>Poor scaling:</strong></p><ul><li>Check for I/O bottlenecks with <code>max_threads</code> reduction</li><li>Monitor memory bandwidth with fewer threads</li><li>Use <code>verbose_threads=true</code> to identify contention</li></ul><p><strong>High GC time:</strong></p><ul><li>Pre-allocate arrays instead of growing with <code>push!</code></li><li>Use in-place operations (<code>@.</code> macro)</li><li>Process data in chunks for large datasets</li></ul><p><strong>Race conditions:</strong></p><ul><li>Use atomic operations for simple reductions</li><li>Pre-allocate arrays with fixed indices per thread</li><li>Add proper synchronization for complex shared state</li></ul><h3 id="Debugging-Tools"><a class="docs-heading-anchor" href="#Debugging-Tools">Debugging Tools</a><a id="Debugging-Tools-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging-Tools" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Thread-safe debugging output
using Base.Threads: SpinLock
debug_lock = SpinLock()
function safe_debug(msg)
    lock(debug_lock) do
        println(&quot;Thread $(threadid()): $msg&quot;)
    end
end</code></pre><hr/><p><em>For complete implementation examples, see the <a href="../../multi-threading/multi-threading_intro/">Multi-Threading Tutorial</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../multi-threading/multi-threading_intro/">« Tutorial</a><a class="docs-footer-nextpage" href="../../advanced_features/testing_guide/">Testing Framework »</a><div class="flexbox-break"></div><p class="footer-message">© 2025 Manuel Behrendt. Built with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and <a href="https://julialang.org">Julia</a>. </p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 9 September 2025 18:51">Tuesday 9 September 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
