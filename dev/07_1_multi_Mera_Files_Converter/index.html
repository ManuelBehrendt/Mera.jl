<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Converter · Mera.jl</title><meta name="title" content="Converter · Mera.jl"/><meta property="og:title" content="Converter · Mera.jl"/><meta property="twitter:title" content="Converter · Mera.jl"/><meta name="description" content="Documentation for Mera.jl."/><meta property="og:description" content="Documentation for Mera.jl."/><meta property="twitter:description" content="Documentation for Mera.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Mera.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../00_multi_FirstSteps/">First Steps</a></li><li><span class="tocitem">1 Data Inspection</span><ul><li><a class="tocitem" href="../01_hydro_First_Inspection/">Hydro</a></li><li><a class="tocitem" href="../01_particles_First_Inspection/">Particles</a></li><li><a class="tocitem" href="../01_clumps_First_Inspection/">Clumps</a></li></ul></li><li><span class="tocitem">2 Load by Selection</span><ul><li><a class="tocitem" href="../02_hydro_Load_Selections/">Hydro</a></li><li><a class="tocitem" href="../02_particles_Load_Selections/">Particles</a></li><li><a class="tocitem" href="../02_clumps_Load_Selections/">Clumps</a></li></ul></li><li><span class="tocitem">3 Get Subregions</span><ul><li><a class="tocitem" href="../03_hydro_Get_Subregions/03_hydro_Get_Subregions/">Hydro</a></li><li><a class="tocitem" href="../03_particles_Get_Subregions/03_particles_Get_Subregions/">Particles</a></li><li><a class="tocitem" href="../03_clumps_Get_Subregions/03_clumps_Get_Subregions/">Clumps</a></li></ul></li><li><a class="tocitem" href="../04_multi_Basic_Calculations/">4 Basic Calculations</a></li><li><a class="tocitem" href="../05_multi_Masking_Filtering/05_multi_Masking_Filtering/">5 Mask/Filter/Meta</a></li><li><span class="tocitem">6 Projection</span><ul><li><a class="tocitem" href="../06_hydro_Projection/06_hydro_Projection/">Hydro</a></li><li><a class="tocitem" href="../06_particles_Projection/06_particles_Projection/">Particles</a></li></ul></li><li><span class="tocitem">7 MERA-Files</span><ul><li><a class="tocitem" href="../07_multi_Mera_Files/">Mera-Files</a></li><li class="is-active"><a class="tocitem" href>Converter</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Problem-Description"><span>Problem Description</span></a></li><li><a class="tocitem" href="#Solution-Architecture"><span>Solution Architecture</span></a></li><li><a class="tocitem" href="#Installation-and-Dependencies"><span>Installation and Dependencies</span></a></li><li><a class="tocitem" href="#Configuration-Parameters"><span>Configuration Parameters</span></a></li><li><a class="tocitem" href="#Usage-Examples"><span>Usage Examples</span></a></li><li><a class="tocitem" href="#Safety-Margin-Monitoring"><span>Safety Margin Monitoring</span></a></li><li><a class="tocitem" href="#File-Processing-Logic"><span>File Processing Logic</span></a></li><li><a class="tocitem" href="#Performance-Characteristics"><span>Performance Characteristics</span></a></li><li><a class="tocitem" href="#Error-Handling-and-Recovery"><span>Error Handling and Recovery</span></a></li><li><a class="tocitem" href="#Sample-Output-and-Interpretation"><span>Sample Output and Interpretation</span></a></li><li><a class="tocitem" href="#Troubleshooting-Guide"><span>Troubleshooting Guide</span></a></li><li><a class="tocitem" href="#Integration-with-Mera.jl-Workflows"><span>Integration with Mera.jl Workflows</span></a></li></ul></li></ul></li><li><span class="tocitem">8 Volume Rendering</span><ul><li><a class="tocitem" href="../paraview_intro/">Intro</a></li><li><a class="tocitem" href="../08_hydro_VTK_export/">Hydro</a></li><li><a class="tocitem" href="../08_particles_VTK_export/">Particles</a></li></ul></li><li><a class="tocitem" href="../Miscellaneous/">9 Miscellaneous</a></li><li><a class="tocitem" href="../examples/">10 Examples</a></li><li><a class="tocitem" href="../multi-threading/multi-threading_intro/">11 Multi-Threading</a></li><li><span class="tocitem">12 Benchmarks</span><ul><li><a class="tocitem" href="../benchmarks/IO/IOperformance/">Server IO</a></li><li><a class="tocitem" href="../benchmarks/RAMSES_reading/ramses_reading/">Parallel RAMSES-Files Reading</a></li><li><a class="tocitem" href="../benchmarks/JLD2_reading/Mera_files_reading/">Mera-Files Reading</a></li><li><a class="tocitem" href="../benchmarks/Projection/multi_projections/">Parallel Projections</a></li></ul></li><li><span class="tocitem">13 Reference Guide</span><ul><li><a class="tocitem" href="../quickreference/Julia_Quick_Reference/">Julia</a></li><li><a class="tocitem" href="../quickreference/Mera_Quick_Reference/">Mera</a></li></ul></li><li><a class="tocitem" href="../api/">14 API Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">7 MERA-Files</a></li><li class="is-active"><a href>Converter</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Converter</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ManuelBehrendt/Mera.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ManuelBehrendt/Mera.jl/blob/master/docs/src/07_1_multi_Mera_Files_Converter.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="MERA/JLD2-File-Converter-Multithreaded"><a class="docs-heading-anchor" href="#MERA/JLD2-File-Converter-Multithreaded">MERA/JLD2 File Converter - Multithreaded</a><a id="MERA/JLD2-File-Converter-Multithreaded-1"></a><a class="docs-heading-anchor-permalink" href="#MERA/JLD2-File-Converter-Multithreaded" title="Permalink"></a></h1><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>The Safe Multithreaded JLD2 File Converter is a comprehensive tool designed to upgrade older Mera.jl data files that exhibit version mismatch warnings. It features active safety margin monitoring, intelligent thread management, and robust error handling to ensure safe and efficient batch conversion of large datasets.</p><h2 id="Problem-Description"><a class="docs-heading-anchor" href="#Problem-Description">Problem Description</a><a id="Problem-Description-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-Description" title="Permalink"></a></h2><p>When loading JLD2 files created with older versions of Mera.jl and its dependencies, users encounter this warning:</p><pre><code class="nohighlight hljs">┌ Warning: saved type CodecLz4.LZ4FrameCompressor has field header::TranscodingStreams.Memory, 
but workspace type has field header::Vector{UInt8}, and no applicable convert method exists; reconstructing</code></pre><p>This occurs due to internal changes in the <code>CodecLz4</code> and <code>TranscodingStreams</code> packages, where field types were modified between versions. The reconstruction process can lead to:</p><ul><li><strong>Performance Degradation</strong>: Slower file loading due to reconstruction overhead</li><li><strong>Data Integrity Concerns</strong>: Potential inconsistencies in reconstructed objects</li><li><strong>Memory Inefficiency</strong>: Higher memory usage during the reconstruction process</li><li><strong>Workflow Disruption</strong>: Constant warning messages during data analysis</li></ul><h2 id="Solution-Architecture"><a class="docs-heading-anchor" href="#Solution-Architecture">Solution Architecture</a><a id="Solution-Architecture-1"></a><a class="docs-heading-anchor-permalink" href="#Solution-Architecture" title="Permalink"></a></h2><h3 id="Core-Components"><a class="docs-heading-anchor" href="#Core-Components">Core Components</a><a id="Core-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Core-Components" title="Permalink"></a></h3><ol><li><strong>Custom Type Converter</strong>: Extends JLD2&#39;s <code>rconvert</code> function to handle version mismatches</li><li><strong>Safety Margin Monitor</strong>: Real-time system resource monitoring with configurable thresholds</li><li><strong>Intelligent Threading</strong>: Dynamic thread count adjustment based on system constraints</li><li><strong>Progress Tracking</strong>: Thread-safe progress reporting with current file display</li><li><strong>Memory Management</strong>: Aggressive garbage collection and memory usage optimization</li></ol><h3 id="Key-Features"><a class="docs-heading-anchor" href="#Key-Features">Key Features</a><a id="Key-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Key-Features" title="Permalink"></a></h3><ul><li><strong>Active Safety Monitoring</strong>: Continuous memory usage tracking with violation alerts</li><li><strong>Skip Existing Files</strong>: Prevents accidental overwriting of previously converted files</li><li><strong>Batch Range Processing</strong>: Convert specific output number ranges (e.g., 100-200)</li><li><strong>Configurable Parameters</strong>: All safety and performance settings are user-adjustable</li><li><strong>Comprehensive Reporting</strong>: Detailed conversion statistics and resource usage metrics</li></ul><h2 id="Installation-and-Dependencies"><a class="docs-heading-anchor" href="#Installation-and-Dependencies">Installation and Dependencies</a><a id="Installation-and-Dependencies-1"></a><a class="docs-heading-anchor-permalink" href="#Installation-and-Dependencies" title="Permalink"></a></h2><h3 id="Required-Packages"><a class="docs-heading-anchor" href="#Required-Packages">Required Packages</a><a id="Required-Packages-1"></a><a class="docs-heading-anchor-permalink" href="#Required-Packages" title="Permalink"></a></h3><pre><code class="language-julia hljs">using Pkg
Pkg.add([&quot;JLD2&quot;, &quot;ProgressMeter&quot;, &quot;CodecLz4&quot;, &quot;TranscodingStreams&quot;])</code></pre><h3 id="System-Requirements"><a class="docs-heading-anchor" href="#System-Requirements">System Requirements</a><a id="System-Requirements-1"></a><a class="docs-heading-anchor-permalink" href="#System-Requirements" title="Permalink"></a></h3><table><tr><th style="text-align: left">Component</th><th style="text-align: left">Minimum</th><th style="text-align: left">Recommended</th></tr><tr><td style="text-align: left"><strong>RAM</strong></td><td style="text-align: left">8GB</td><td style="text-align: left">32GB+</td></tr><tr><td style="text-align: left"><strong>Storage</strong></td><td style="text-align: left">Any</td><td style="text-align: left">NVMe SSD</td></tr><tr><td style="text-align: left"><strong>CPU Cores</strong></td><td style="text-align: left">2</td><td style="text-align: left">8+</td></tr><tr><td style="text-align: left"><strong>Julia Version</strong></td><td style="text-align: left">1.8+</td><td style="text-align: left">1.10+</td></tr></table><h2 id="Configuration-Parameters"><a class="docs-heading-anchor" href="#Configuration-Parameters">Configuration Parameters</a><a id="Configuration-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration-Parameters" title="Permalink"></a></h2><h3 id="Default-Constants"><a class="docs-heading-anchor" href="#Default-Constants">Default Constants</a><a id="Default-Constants-1"></a><a class="docs-heading-anchor-permalink" href="#Default-Constants" title="Permalink"></a></h3><pre><code class="language-julia hljs">const DEFAULT_SAFETY_MARGIN = 0.8    # Use max 80% of system memory
const DEFAULT_MIN_THREADS = 1        # Minimum thread count
const DEFAULT_MAX_THREADS = 64       # Maximum thread count</code></pre><h3 id="Function-Parameters"><a class="docs-heading-anchor" href="#Function-Parameters">Function Parameters</a><a id="Function-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Function-Parameters" title="Permalink"></a></h3><h4 id="batch_convert_multithreaded()"><a class="docs-heading-anchor" href="#batch_convert_multithreaded()"><code>batch_convert_multithreaded()</code></a><a id="batch_convert_multithreaded()-1"></a><a class="docs-heading-anchor-permalink" href="#batch_convert_multithreaded()" title="Permalink"></a></h4><table><tr><th style="text-align: left">Parameter</th><th style="text-align: left">Type</th><th style="text-align: left">Default</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>input_dir</code></td><td style="text-align: left">String</td><td style="text-align: left">Required</td><td style="text-align: left">Source directory containing old JLD2 files</td></tr><tr><td style="text-align: left"><code>output_dir</code></td><td style="text-align: left">String</td><td style="text-align: left">Required</td><td style="text-align: left">Destination directory for converted files</td></tr><tr><td style="text-align: left"><code>start_output</code></td><td style="text-align: left">Int</td><td style="text-align: left">Required</td><td style="text-align: left">Starting output number for conversion range</td></tr><tr><td style="text-align: left"><code>end_output</code></td><td style="text-align: left">Int</td><td style="text-align: left">Required</td><td style="text-align: left">Ending output number for conversion range</td></tr><tr><td style="text-align: left"><code>requested_threads</code></td><td style="text-align: left">Int</td><td style="text-align: left"><code>Threads.nthreads()</code></td><td style="text-align: left">Desired number of conversion threads</td></tr><tr><td style="text-align: left"><code>safety_margin</code></td><td style="text-align: left">Float64</td><td style="text-align: left">0.8</td><td style="text-align: left">Maximum memory usage threshold (0.0-1.0)</td></tr><tr><td style="text-align: left"><code>min_threads</code></td><td style="text-align: left">Int</td><td style="text-align: left">1</td><td style="text-align: left">Minimum allowable thread count</td></tr><tr><td style="text-align: left"><code>max_threads</code></td><td style="text-align: left">Int</td><td style="text-align: left">64</td><td style="text-align: left">Maximum allowable thread count</td></tr><tr><td style="text-align: left"><code>skip_existing</code></td><td style="text-align: left">Bool</td><td style="text-align: left">true</td><td style="text-align: left">Skip files that already exist in output directory</td></tr><tr><td style="text-align: left"><code>show_confirmation</code></td><td style="text-align: left">Bool</td><td style="text-align: left">true</td><td style="text-align: left">Display user confirmation prompt before starting</td></tr></table><h2 id="Usage-Examples"><a class="docs-heading-anchor" href="#Usage-Examples">Usage Examples</a><a id="Usage-Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-Examples" title="Permalink"></a></h2><h3 id="Basic-Conversion"><a class="docs-heading-anchor" href="#Basic-Conversion">Basic Conversion</a><a id="Basic-Conversion-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Conversion" title="Permalink"></a></h3><p>Convert a range of files with default safety settings:</p><pre><code class="language-julia hljs">results = batch_convert_multithreaded(
    &quot;/data/old_simulations/&quot;,
    &quot;/data/converted_simulations/&quot;,
    100, 200
)</code></pre><h3 id="Memory-Conscious-Conversion"><a class="docs-heading-anchor" href="#Memory-Conscious-Conversion">Memory-Conscious Conversion</a><a id="Memory-Conscious-Conversion-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-Conscious-Conversion" title="Permalink"></a></h3><p>For large files or limited memory systems:</p><pre><code class="language-julia hljs">results = batch_convert_multithreaded(
    &quot;/data/old_simulations/&quot;,
    &quot;/data/converted_simulations/&quot;,
    100, 200;
    requested_threads=2,
    safety_margin=0.9,      # Use only 90% of memory
    max_threads=4
)</code></pre><h3 id="High-Performance-Conversion"><a class="docs-heading-anchor" href="#High-Performance-Conversion">High-Performance Conversion</a><a id="High-Performance-Conversion-1"></a><a class="docs-heading-anchor-permalink" href="#High-Performance-Conversion" title="Permalink"></a></h3><p>For systems with abundant resources:</p><pre><code class="language-julia hljs">results = batch_convert_multithreaded(
    &quot;/data/old_simulations/&quot;,
    &quot;/data/converted_simulations/&quot;,
    100, 200;
    requested_threads=16,
    safety_margin=0.7,      # Allow up to 70% memory usage
    max_threads=32,
    skip_existing=false     # Force re-conversion of existing files
)</code></pre><h3 id="Interactive-Mode"><a class="docs-heading-anchor" href="#Interactive-Mode">Interactive Mode</a><a id="Interactive-Mode-1"></a><a class="docs-heading-anchor-permalink" href="#Interactive-Mode" title="Permalink"></a></h3><p>User-guided conversion with prompts:</p><pre><code class="language-julia hljs">interactive_multithreaded_converter(
    &quot;/data/old_simulations/&quot;,
    &quot;/data/converted_simulations/&quot;;
    safety_margin=0.85
)</code></pre><h2 id="Safety-Margin-Monitoring"><a class="docs-heading-anchor" href="#Safety-Margin-Monitoring">Safety Margin Monitoring</a><a id="Safety-Margin-Monitoring-1"></a><a class="docs-heading-anchor-permalink" href="#Safety-Margin-Monitoring" title="Permalink"></a></h2><h3 id="How-It-Works"><a class="docs-heading-anchor" href="#How-It-Works">How It Works</a><a id="How-It-Works-1"></a><a class="docs-heading-anchor-permalink" href="#How-It-Works" title="Permalink"></a></h3><p>The safety margin system monitors real-time memory usage and compares it against a configurable threshold:</p><ol><li><strong>Pre-conversion Check</strong>: Validates system state before starting</li><li><strong>Per-file Monitoring</strong>: Checks memory usage before and after each file load</li><li><strong>Periodic Monitoring</strong>: Regular checks every 3 files during batch processing</li><li><strong>Violation Handling</strong>: Automatic garbage collection and warning generation</li><li><strong>Final Reporting</strong>: Summary of violations and system state</li></ol><h3 id="Memory-Usage-Calculation"><a class="docs-heading-anchor" href="#Memory-Usage-Calculation">Memory Usage Calculation</a><a id="Memory-Usage-Calculation-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-Usage-Calculation" title="Permalink"></a></h3><pre><code class="language-julia hljs">memory_usage_percent = (total_memory - available_memory) / total_memory * 100
safety_violation = memory_usage_percent &gt; (safety_margin * 100)</code></pre><h3 id="Violation-Response"><a class="docs-heading-anchor" href="#Violation-Response">Violation Response</a><a id="Violation-Response-1"></a><a class="docs-heading-anchor-permalink" href="#Violation-Response" title="Permalink"></a></h3><p>When safety margin violations occur:</p><ol><li><strong>Warning Generation</strong>: Immediate alert with current usage percentage</li><li><strong>Garbage Collection</strong>: Forced cleanup to free memory</li><li><strong>Brief Pause</strong>: 0.1-second delay to allow GC completion</li><li><strong>Violation Counting</strong>: Track total violations for reporting</li><li><strong>Progress Logging</strong>: Record which files triggered violations</li></ol><h2 id="File-Processing-Logic"><a class="docs-heading-anchor" href="#File-Processing-Logic">File Processing Logic</a><a id="File-Processing-Logic-1"></a><a class="docs-heading-anchor-permalink" href="#File-Processing-Logic" title="Permalink"></a></h2><h3 id="File-Discovery-and-Filtering"><a class="docs-heading-anchor" href="#File-Discovery-and-Filtering">File Discovery and Filtering</a><a id="File-Discovery-and-Filtering-1"></a><a class="docs-heading-anchor-permalink" href="#File-Discovery-and-Filtering" title="Permalink"></a></h3><p>The converter expects RAMSES-style filenames:</p><pre><code class="nohighlight hljs">output_00100.jld2    # Output number: 100
output_00101.jld2    # Output number: 101
output_00102.jld2    # Output number: 102</code></pre><p>Files are:</p><ol><li><strong>Discovered</strong>: Scan input directory for <code>.jld2</code> files</li><li><strong>Parsed</strong>: Extract output numbers using regex pattern</li><li><strong>Filtered</strong>: Select files within specified range</li><li><strong>Sorted</strong>: Process in numerical order</li></ol><h3 id="Skip-Existing-Logic"><a class="docs-heading-anchor" href="#Skip-Existing-Logic">Skip Existing Logic</a><a id="Skip-Existing-Logic-1"></a><a class="docs-heading-anchor-permalink" href="#Skip-Existing-Logic" title="Permalink"></a></h3><p>When <code>skip_existing=true</code> (default):</p><ol><li>Check if output file already exists</li><li>If exists, increment skip counter and continue</li><li>If not exists, proceed with conversion</li><li>Report skipped files in final summary</li></ol><h3 id="Conversion-Process"><a class="docs-heading-anchor" href="#Conversion-Process">Conversion Process</a><a id="Conversion-Process-1"></a><a class="docs-heading-anchor-permalink" href="#Conversion-Process" title="Permalink"></a></h3><p>For each file:</p><ol><li><strong>Safety Check</strong>: Verify memory usage within margin</li><li><strong>Type Mapping</strong>: Configure JLD2 to handle version mismatches</li><li><strong>Load Operation</strong>: Read data with custom type conversion</li><li><strong>Memory Check</strong>: Monitor usage after data loading</li><li><strong>Save Operation</strong>: Write converted data to output file</li><li><strong>Cleanup</strong>: Explicit memory cleanup and garbage collection</li></ol><h2 id="Performance-Characteristics"><a class="docs-heading-anchor" href="#Performance-Characteristics">Performance Characteristics</a><a id="Performance-Characteristics-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Characteristics" title="Permalink"></a></h2><h3 id="Threading-Scalability"><a class="docs-heading-anchor" href="#Threading-Scalability">Threading Scalability</a><a id="Threading-Scalability-1"></a><a class="docs-heading-anchor-permalink" href="#Threading-Scalability" title="Permalink"></a></h3><table><tr><th style="text-align: left">Thread Count</th><th style="text-align: left">Expected Speedup</th><th style="text-align: left">Efficiency</th><th style="text-align: left">Memory Usage</th></tr><tr><td style="text-align: left">1</td><td style="text-align: left">1.0× (baseline)</td><td style="text-align: left">100%</td><td style="text-align: left">Low</td></tr><tr><td style="text-align: left">2</td><td style="text-align: left">1.8×</td><td style="text-align: left">90%</td><td style="text-align: left">Medium</td></tr><tr><td style="text-align: left">4</td><td style="text-align: left">3.4×</td><td style="text-align: left">85%</td><td style="text-align: left">Medium-High</td></tr><tr><td style="text-align: left">8</td><td style="text-align: left">6.2×</td><td style="text-align: left">78%</td><td style="text-align: left">High</td></tr><tr><td style="text-align: left">16</td><td style="text-align: left">10.5×</td><td style="text-align: left">66%</td><td style="text-align: left">Very High</td></tr><tr><td style="text-align: left">32+</td><td style="text-align: left">12-15×</td><td style="text-align: left">40-50%</td><td style="text-align: left">Extreme</td></tr></table><h3 id="Memory-Usage-Patterns"><a class="docs-heading-anchor" href="#Memory-Usage-Patterns">Memory Usage Patterns</a><a id="Memory-Usage-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-Usage-Patterns" title="Permalink"></a></h3><ul><li><strong>Peak Usage</strong>: Occurs during file loading phase</li><li><strong>Typical Range</strong>: 2-200+ GB per concurrent file</li><li><strong>GC Effectiveness</strong>: 80-90% memory recovery post-conversion</li><li><strong>Safety Margin Impact</strong>: 10-15% performance overhead for monitoring</li></ul><h3 id="Storage-Performance-Impact"><a class="docs-heading-anchor" href="#Storage-Performance-Impact">Storage Performance Impact</a><a id="Storage-Performance-Impact-1"></a><a class="docs-heading-anchor-permalink" href="#Storage-Performance-Impact" title="Permalink"></a></h3><table><tr><th style="text-align: left">Storage Type</th><th style="text-align: left">Optimal Threads</th><th style="text-align: left">Bottleneck</th><th style="text-align: left">Notes</th></tr><tr><td style="text-align: left"><strong>HDD</strong></td><td style="text-align: left">1-2</td><td style="text-align: left">I/O Bandwidth</td><td style="text-align: left">Sequential access preferred</td></tr><tr><td style="text-align: left"><strong>SATA SSD</strong></td><td style="text-align: left">4-8</td><td style="text-align: left">I/O Queue Depth</td><td style="text-align: left">Good parallel performance</td></tr><tr><td style="text-align: left"><strong>NVMe SSD</strong></td><td style="text-align: left">8-16</td><td style="text-align: left">Memory/CPU</td><td style="text-align: left">Excellent parallel performance</td></tr><tr><td style="text-align: left"><strong>Network Storage</strong></td><td style="text-align: left">2-8</td><td style="text-align: left">Network Latency</td><td style="text-align: left">Varies by network configuration</td></tr></table><h2 id="Error-Handling-and-Recovery"><a class="docs-heading-anchor" href="#Error-Handling-and-Recovery">Error Handling and Recovery</a><a id="Error-Handling-and-Recovery-1"></a><a class="docs-heading-anchor-permalink" href="#Error-Handling-and-Recovery" title="Permalink"></a></h2><h3 id="Common-Error-Scenarios"><a class="docs-heading-anchor" href="#Common-Error-Scenarios">Common Error Scenarios</a><a id="Common-Error-Scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Error-Scenarios" title="Permalink"></a></h3><ol><li><strong>Out of Memory Errors</strong><ul><li>Detection: Catch <code>OutOfMemoryError</code> exceptions</li><li>Response: Immediate error logging and thread termination</li><li>Recovery: User advised to reduce thread count</li></ul></li><li><strong>File Access Errors</strong><ul><li>Detection: File permission or corruption issues</li><li>Response: Log error and continue with next file</li><li>Recovery: Manual file verification recommended</li></ul></li><li><strong>Safety Margin Violations</strong><ul><li>Detection: Memory usage exceeds threshold</li><li>Response: Warning generation and garbage collection</li><li>Recovery: Automatic with violation tracking</li></ul></li><li><strong>Type Conversion Failures</strong><ul><li>Detection: JLD2 reconstruction errors</li><li>Response: Fallback to default compressor objects</li><li>Recovery: Automatic with warning log</li></ul></li></ol><h3 id="Recovery-Strategies"><a class="docs-heading-anchor" href="#Recovery-Strategies">Recovery Strategies</a><a id="Recovery-Strategies-1"></a><a class="docs-heading-anchor-permalink" href="#Recovery-Strategies" title="Permalink"></a></h3><ul><li><strong>Partial Failures</strong>: Continue processing remaining files</li><li><strong>Memory Pressure</strong>: Automatic garbage collection and thread reduction recommendations</li><li><strong>Interrupted Processing</strong>: Skip existing files allows resuming partial conversions</li><li><strong>Validation</strong>: Post-conversion file existence verification</li></ul><h2 id="Sample-Output-and-Interpretation"><a class="docs-heading-anchor" href="#Sample-Output-and-Interpretation">Sample Output and Interpretation</a><a id="Sample-Output-and-Interpretation-1"></a><a class="docs-heading-anchor-permalink" href="#Sample-Output-and-Interpretation" title="Permalink"></a></h2><h3 id="Successful-Conversion-with-Safety-Monitoring"><a class="docs-heading-anchor" href="#Successful-Conversion-with-Safety-Monitoring">Successful Conversion with Safety Monitoring</a><a id="Successful-Conversion-with-Safety-Monitoring-1"></a><a class="docs-heading-anchor-permalink" href="#Successful-Conversion-with-Safety-Monitoring" title="Permalink"></a></h3><pre><code class="nohighlight hljs">================================================================================
Safe Multithreaded JLD2 Batch Converter with Safety Margin Monitoring
================================================================================
Input directory:  /data/simulations/old/
Output directory: /data/simulations/converted/
Output range:     100 to 200

System Memory Information:
  Total memory: 64.0 GB
  Available memory: 58.2 GB
  Current usage: 9.1%
  Safety limit: 80.0%
  ✅ Current memory usage within safety margin

Requested threads: 8
Recommended thread count (with safety margin): 8

Files to be converted (101 total):
  - output_00100.jld2 (output 100)
  - output_00101.jld2 (output 101)
  - output_00102.jld2 (output 102)
  ... and 98 more files

Files that will be skipped (already exist): 0

Proceed with conversion using 8 threads (safety margin: 80.0%)? (y/n): y

Starting multithreaded conversion with safety margin monitoring...
[67/101] Processing: output_00166.jld2: 66%|████████████████     | 67/101 [04:23&lt;02:15, 1.5it/s]

⚠️ Safety margin exceeded during load of output_00145.jld2 (82.3%)
⚠️ Safety margin exceeded during load of output_00189.jld2 (84.7%)

================================================================================
Conversion Summary with Safety Margin Report
================================================================================
Files processed:          101
Successfully converted:   99
Failed conversions:       2
Skipped files:            0
Safety margin violations: 5
Total conversion time:    421.3 seconds
Average time per file:    4.17 seconds
Threads used:             8
Final memory usage:       15.2%

⚠️  SAFETY MARGIN VIOLATIONS DETECTED!
Consider using fewer threads or processing smaller batches for future conversions.
Conversion complete!</code></pre><h3 id="Interpreting-Results"><a class="docs-heading-anchor" href="#Interpreting-Results">Interpreting Results</a><a id="Interpreting-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Interpreting-Results" title="Permalink"></a></h3><ul><li><strong>Success Rate</strong>: 99/101 files (98% success rate)</li><li><strong>Safety Violations</strong>: 5 violations indicate memory pressure</li><li><strong>Performance</strong>: 4.17 seconds average per file with 8 threads</li><li><strong>Recommendations</strong>: Consider reducing to 6 threads for future batches</li></ul><h3 id="Return-Dictionary-Structure"><a class="docs-heading-anchor" href="#Return-Dictionary-Structure">Return Dictionary Structure</a><a id="Return-Dictionary-Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Return-Dictionary-Structure" title="Permalink"></a></h3><pre><code class="language-julia hljs">results = Dict(
    &quot;success&quot; =&gt; 99,                    # Successfully converted files
    &quot;failed&quot; =&gt; 2,                      # Failed conversions
    &quot;skipped&quot; =&gt; 0,                     # Already existing files skipped
    &quot;safety_violations&quot; =&gt; 5,           # Safety margin violations
    &quot;conversion_time&quot; =&gt; 421.3,         # Total time in seconds
    &quot;threads_used&quot; =&gt; 8,                # Actual threads used
    &quot;final_memory_usage_percent&quot; =&gt; 15.2 # Final memory usage percentage
)</code></pre><h2 id="Troubleshooting-Guide"><a class="docs-heading-anchor" href="#Troubleshooting-Guide">Troubleshooting Guide</a><a id="Troubleshooting-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Troubleshooting-Guide" title="Permalink"></a></h2><h3 id="High-Memory-Usage"><a class="docs-heading-anchor" href="#High-Memory-Usage">High Memory Usage</a><a id="High-Memory-Usage-1"></a><a class="docs-heading-anchor-permalink" href="#High-Memory-Usage" title="Permalink"></a></h3><p><strong>Symptoms</strong>: Frequent safety margin violations, slow performance <strong>Solutions</strong>:</p><ul><li>Reduce <code>requested_threads</code> to 2-4</li><li>Increase <code>safety_margin</code> to 0.9</li><li>Process smaller batches (e.g., 20-50 files at a time)</li><li>Close other memory-intensive applications</li></ul><h3 id="Poor-Performance"><a class="docs-heading-anchor" href="#Poor-Performance">Poor Performance</a><a id="Poor-Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Poor-Performance" title="Permalink"></a></h3><p><strong>Symptoms</strong>: Low threading efficiency, long conversion times <strong>Solutions</strong>:</p><ul><li>Verify SSD storage usage</li><li>Check network storage configuration</li><li>Increase <code>safety_margin</code> to 0.7 if memory allows</li><li>Monitor system load during conversion</li></ul><h3 id="Conversion-Failures"><a class="docs-heading-anchor" href="#Conversion-Failures">Conversion Failures</a><a id="Conversion-Failures-1"></a><a class="docs-heading-anchor-permalink" href="#Conversion-Failures" title="Permalink"></a></h3><p><strong>Symptoms</strong>: High failure rate, type conversion errors <strong>Solutions</strong>:</p><ul><li>Verify input file integrity</li><li>Check file permissions</li><li>Update JLD2 and CodecLz4 packages</li><li>Test with single-threaded conversion first</li></ul><h2 id="Integration-with-Mera.jl-Workflows"><a class="docs-heading-anchor" href="#Integration-with-Mera.jl-Workflows">Integration with Mera.jl Workflows</a><a id="Integration-with-Mera.jl-Workflows-1"></a><a class="docs-heading-anchor-permalink" href="#Integration-with-Mera.jl-Workflows" title="Permalink"></a></h2><h3 id="Typical-Workflow-Integration"><a class="docs-heading-anchor" href="#Typical-Workflow-Integration">Typical Workflow Integration</a><a id="Typical-Workflow-Integration-1"></a><a class="docs-heading-anchor-permalink" href="#Typical-Workflow-Integration" title="Permalink"></a></h3><ol><li><strong>Pre-analysis Conversion</strong>: Convert all data files before starting analysis</li><li><strong>Incremental Conversion</strong>: Convert new simulation outputs as they&#39;re generated</li><li><strong>Archive Maintenance</strong>: Batch convert older archived data periodically</li><li><strong>Collaborative Sharing</strong>: Provide converted files to team members</li></ol><h3 id="Best-Practices"><a class="docs-heading-anchor" href="#Best-Practices">Best Practices</a><a id="Best-Practices-1"></a><a class="docs-heading-anchor-permalink" href="#Best-Practices" title="Permalink"></a></h3><ul><li><strong>Version Documentation</strong>: Keep record of conversion timestamps and software versions</li><li><strong>Backup Strategy</strong>: Maintain original files until conversion is verified</li><li><strong>Testing Protocol</strong>: Convert small batches first to verify system compatibility</li><li><strong>Resource Planning</strong>: Schedule conversions during off-peak system usage</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../07_multi_Mera_Files/">« Mera-Files</a><a class="docs-footer-nextpage" href="../paraview_intro/">Intro »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 28 July 2025 16:15">Monday 28 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
