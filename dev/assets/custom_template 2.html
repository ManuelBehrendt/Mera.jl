<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  {{{:title}}}
  {{{:favicon}}}
  {{{:stylesheet}}}
  {{{:mathengine}}}
  
  <!-- Music Player Styles -->
  <style>
    #mera-top-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 45px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
      z-index: 999999;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.2);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      box-sizing: border-box;
    }
    
    body {
      padding-top: 45px !important;
    }
    
    #documenter {
      margin-top: 0 !important;
    }
    
    .mera-music-btn {
      padding: 4px 12px;
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 4px;
      color: white;
      cursor: pointer;
      font-size: 12px;
      border: none;
      outline: none;
    }
    
    .mera-music-btn:hover {
      background: rgba(255,255,255,0.3);
    }
    
    #mera-top-volume {
      width: 80px;
      height: 4px;
      background: rgba(255,255,255,0.3);
      outline: none;
      border-radius: 2px;
      -webkit-appearance: none;
    }
    
    #mera-top-volume::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: white;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <!-- Persistent Music Player Top Bar -->
  <div id="mera-top-bar">
    <div style="display: flex; align-items: center; gap: 15px;">
      <span style="color: white; font-weight: 600; font-size: 14px;">üéµ MERA Study Music</span>
      <button id="mera-top-play-btn" class="mera-music-btn">üîÄ Play Random</button>
      <button id="mera-top-pause-btn" class="mera-music-btn" style="display: none;">‚è∏Ô∏è Pause</button>
    </div>
    <div style="display: flex; align-items: center; gap: 10px;">
      <span id="mera-top-status" style="color: rgba(255,255,255,0.9); font-size: 12px;">Ready to play</span>
      <input type="range" id="mera-top-volume" min="0" max="100" value="15">
      <span id="mera-top-volume-display" style="color: rgba(255,255,255,0.9); font-size: 12px;">15%</span>
    </div>
  </div>

  <!-- Documenter Content -->
  <div id="documenter">
    {{{:content}}}
  </div>
  
  <!-- Music Player JavaScript -->
  <script>
    // Global audio element that persists
    if (!window.meraGlobalAudio) {
      window.meraGlobalAudio = new Audio();
      window.meraGlobalAudio.volume = 0.15;
    }
    
    // Music library
    const musicTracks = [
      { file: 'alpha_centauri.mp3', name: 'Alpha Centauri' },
      { file: 'andromeda_galaxy.mp3', name: 'Andromeda Galaxy' },
      { file: 'betelgeuse_supergiant.mp3', name: 'Betelgeuse Supergiant' },
      { file: 'cassiopeia_constellation.mp3', name: 'Cassiopeia Constellation' },
      { file: 'crab_nebula.mp3', name: 'Crab Nebula' },
      { file: 'eagle_nebula.mp3', name: 'Eagle Nebula' },
      { file: 'horsehead_nebula.mp3', name: 'Horsehead Nebula' },
      { file: 'orion_nebula.mp3', name: 'Orion Nebula' },
      { file: 'proxima_centauri.mp3', name: 'Proxima Centauri' },
      { file: 'sagittarius_a_star.mp3', name: 'Sagittarius A Star' },
      { file: 'vega.mp3', name: 'Vega' }
    ];
    
    let isPlaying = false;
    
    // Get random track
    function getRandomTrack() {
      const randomIndex = Math.floor(Math.random() * musicTracks.length);
      return musicTracks[randomIndex];
    }
    
    // Get track display name
    function getTrackDisplayName(filename) {
      if (!filename) return 'Unknown Track';
      return filename.replace(/\.(wav|mp3)$/, '').replace(/_/g, ' ')
        .split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
    }
    
    // Get current track name
    function getCurrentTrackName() {
      if (!window.meraGlobalAudio.src) return 'Unknown Track';
      const filename = window.meraGlobalAudio.src.split('/').pop();
      return getTrackDisplayName(filename);
    }
    
    // Update UI
    function updateUI() {
      const playBtn = document.getElementById('mera-top-play-btn');
      const pauseBtn = document.getElementById('mera-top-pause-btn');
      const status = document.getElementById('mera-top-status');
      
      if (isPlaying) {
        playBtn.style.display = 'none';
        pauseBtn.style.display = 'inline-block';
        status.textContent = `Playing: ${getCurrentTrackName()}`;
      } else {
        playBtn.style.display = 'inline-block';
        pauseBtn.style.display = 'none';
        if (window.meraGlobalAudio.src) {
          status.textContent = `Ready: ${getCurrentTrackName()}`;
        } else {
          status.textContent = 'Ready to play';
        }
      }
    }
    
    // Load and play track
    async function playRandomTrack() {
      const track = getRandomTrack();
      const musicPath = `assets/music/${track.file}`;
      
      window.meraGlobalAudio.src = musicPath;
      
      try {
        await window.meraGlobalAudio.play();
        isPlaying = true;
        updateUI();
      } catch (error) {
        console.error('Error playing music:', error);
        document.getElementById('mera-top-status').textContent = 'Error playing music';
      }
    }
    
    // Pause music
    function pauseMusic() {
      window.meraGlobalAudio.pause();
      isPlaying = false;
      updateUI();
    }
    
    // Set volume
    function setVolume(volume) {
      window.meraGlobalAudio.volume = volume;
      document.getElementById('mera-top-volume-display').textContent = `${Math.round(volume * 100)}%`;
    }
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      // Set up event listeners
      document.getElementById('mera-top-play-btn').addEventListener('click', playRandomTrack);
      document.getElementById('mera-top-pause-btn').addEventListener('click', pauseMusic);
      
      document.getElementById('mera-top-volume').addEventListener('input', function(e) {
        setVolume(e.target.value / 100);
      });
      
      // Handle audio events
      window.meraGlobalAudio.addEventListener('ended', () => {
        if (isPlaying) {
          playRandomTrack(); // Play next random track
        }
      });
      
      window.meraGlobalAudio.addEventListener('pause', () => {
        isPlaying = false;
        updateUI();
      });
      
      window.meraGlobalAudio.addEventListener('play', () => {
        isPlaying = true;
        updateUI();
      });
      
      // Update UI on page load
      updateUI();
    });
  </script>
  
  {{{:js}}}
</body>
</html>