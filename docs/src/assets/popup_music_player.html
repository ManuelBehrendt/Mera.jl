<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MERA Study Music</title>
    <style>
        body {
            margin: 0;
            padding: 12px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px;
            min-width: 280px;
        }
        
        .header {
            text-align: center;
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .btn {
            padding: 4px 8px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 11px;
            outline: none;
        }
        
        .btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        #status {
            flex: 1;
            text-align: center;
            font-size: 11px;
            opacity: 0.9;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
        }
        
        #volume-slider {
            flex: 1;
            height: 4px;
            background: rgba(255,255,255,0.3);
            outline: none;
            border-radius: 2px;
            -webkit-appearance: none;
        }
        
        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
        }
        
        .close-btn {
            position: absolute;
            top: 4px;
            right: 6px;
            background: none;
            border: none;
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            cursor: pointer;
            padding: 2px;
        }
        
        .close-btn:hover {
            color: white;
        }
    </style>
</head>
<body>
    <button class="close-btn" onclick="window.close()" title="Close music player">√ó</button>
    
    <div class="header">üéµ MERA Study Music</div>
    
    <div class="controls">
        <button id="play-btn" class="btn">‚ñ∂ Play</button>
        <button id="pause-btn" class="btn" style="display: none;">‚è∏ Pause</button>
        <button id="next-btn" class="btn">‚è≠ Next</button>
        <span id="status">Ready to play</span>
    </div>
    
    <div class="volume-control">
        <span style="font-size: 10px;">üîä</span>
        <input type="range" id="volume-slider" min="0" max="100" value="15">
        <span id="volume-display" style="font-size: 10px;">15%</span>
    </div>
    
    <script>
        const tracks = [
            'alpha_centauri.mp3', 'andromeda_galaxy.mp3', 'betelgeuse_supergiant.mp3',
            'cassiopeia_constellation.mp3', 'crab_nebula.mp3', 'eagle_nebula.mp3',
            'horsehead_nebula.mp3', 'orion_nebula.mp3', 'proxima_centauri.mp3',
            'sagittarius_a_star.mp3', 'vega.mp3'
        ];
        
        const audio = new Audio();
        let isPlaying = false;
        let currentTrack = '';
        
        audio.volume = 0.15;
        
        // Path to music files (relative to popup window opener)
        function getMusicPath(filename) {
            // Use opener's origin to construct correct path
            const baseUrl = window.opener ? window.opener.location.origin + window.opener.location.pathname.split('/').slice(0, -1).join('/') : '.';
            return `${baseUrl}/assets/music/${filename}`;
        }
        
        function getTrackDisplayName(filename) {
            return filename.replace(/\.mp3$/, '').replace(/_/g, ' ')
                .split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        }
        
        function updateUI() {
            const playBtn = document.getElementById('play-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const status = document.getElementById('status');
            
            if (isPlaying) {
                playBtn.style.display = 'none';
                pauseBtn.style.display = 'inline-block';
                status.textContent = `‚ô™ ${getTrackDisplayName(currentTrack)}`;
            } else {
                playBtn.style.display = 'inline-block';
                pauseBtn.style.display = 'none';
                status.textContent = currentTrack ? `‚è∏ ${getTrackDisplayName(currentTrack)}` : 'Ready to play';
            }
        }
        
        async function playRandomTrack() {
            const randomTrack = tracks[Math.floor(Math.random() * tracks.length)];
            currentTrack = randomTrack;
            audio.src = getMusicPath(randomTrack);
            
            try {
                await audio.play();
                isPlaying = true;
                updateUI();
                console.log('üéµ Playing:', randomTrack);
            } catch (error) {
                console.log('üéµ Play error:', error.message);
                status.textContent = 'Click play to start';
                isPlaying = false;
                updateUI();
            }
        }
        
        function pauseMusic() {
            audio.pause();
            isPlaying = false;
            updateUI();
        }
        
        function setVolume(volume) {
            audio.volume = volume;
            document.getElementById('volume-display').textContent = `${Math.round(volume * 100)}%`;
        }
        
        // Event listeners
        document.getElementById('play-btn').addEventListener('click', playRandomTrack);
        document.getElementById('pause-btn').addEventListener('click', pauseMusic);
        document.getElementById('next-btn').addEventListener('click', playRandomTrack);
        
        document.getElementById('volume-slider').addEventListener('input', function(e) {
            setVolume(e.target.value / 100);
        });
        
        // Auto-play next track when current ends
        audio.addEventListener('ended', () => {
            if (isPlaying) {
                playRandomTrack();
            }
        });
        
        audio.addEventListener('play', () => {
            isPlaying = true;
            updateUI();
        });
        
        audio.addEventListener('pause', () => {
            isPlaying = false;
            updateUI();
        });
        
        // Keep window always on top (if supported)
        if (window.focus) {
            setInterval(() => {
                if (isPlaying && !document.hidden) {
                    // Don't steal focus, just ensure visibility
                }
            }, 30000);
        }
        
        console.log('üéµ Popup music player initialized');
    </script>
</body>
</html>